   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.file	"spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.comm	xSemaphoreDMASPI,4,4
  20              		.comm	xSmphrUSART,4,4
  21              		.comm	xSemaphoreREADLEN,4,4
  22              		.comm	motorHeartBeatHandle,4,4
  23              		.comm	motorHBHandle,4,4
  24              		.comm	QSpd_handle,4,4
  25              		.comm	QTCP_handle,4,4
  26              		.comm	socket_0,4,4
  27              		.comm	bufferTX,2000,4
  28              		.comm	bufferRX,2000,4
  29              		.comm	bufferRXidx,4,4
  30              		.comm	bufferTXidx,4,4
  31              		.comm	dat_lengthRX,4,4
  32              		.comm	dat_lengthTX,4,4
  33              		.section	.text.init_SPIx,"ax",%progbits
  34              		.align	2
  35              		.global	init_SPIx
  36              		.thumb
  37              		.thumb_func
  39              	init_SPIx:
  40              	.LFB110:
  41              		.file 1 "App/STM32F4-Discovery/spi.c"
   1:App/STM32F4-Discovery/spi.c **** /*! \file spi.c */ 
   2:App/STM32F4-Discovery/spi.c **** 
   3:App/STM32F4-Discovery/spi.c **** #include "spi.h"
   4:App/STM32F4-Discovery/spi.c **** #define pdFalse 0
   5:App/STM32F4-Discovery/spi.c **** #define pdTrue 	1
   6:App/STM32F4-Discovery/spi.c **** 
   7:App/STM32F4-Discovery/spi.c **** /*============================================================================
   8:App/STM32F4-Discovery/spi.c ****  * 	func void init_SPIx(void)
   9:App/STM32F4-Discovery/spi.c ****  *===========================================================================*/ 
  10:App/STM32F4-Discovery/spi.c **** void init_SPIx(void){
  42              		.loc 1 10 0
  43              		.cfi_startproc
  44              		@ args = 0, pretend = 0, frame = 104
  45              		@ frame_needed = 1, uses_anonymous_args = 0
  46 0000 80B5     		push	{r7, lr}
  47              	.LCFI0:
  48              		.cfi_def_cfa_offset 8
  49              		.cfi_offset 7, -8
  50              		.cfi_offset 14, -4
  51 0002 9AB0     		sub	sp, sp, #104
  52              	.LCFI1:
  53              		.cfi_def_cfa_offset 112
  54 0004 00AF     		add	r7, sp, #0
  55              	.LCFI2:
  56              		.cfi_def_cfa_register 7
  11:App/STM32F4-Discovery/spi.c **** 	
  12:App/STM32F4-Discovery/spi.c **** 
  13:App/STM32F4-Discovery/spi.c **** 	/*! Initialize SPI pheriphial with DMA controller \n
  14:App/STM32F4-Discovery/spi.c **** 	 *  - SPI setup
  15:App/STM32F4-Discovery/spi.c **** 	 *  	+ MISO PA6
  16:App/STM32F4-Discovery/spi.c **** 	 *  	+ MOSI PA7
  17:App/STM32F4-Discovery/spi.c **** 	 *  	+ SCK PA5
  18:App/STM32F4-Discovery/spi.c **** 	 *	+ CS PA4
  19:App/STM32F4-Discovery/spi.c **** 	 *	+ HR pin PC5
  20:App/STM32F4-Discovery/spi.c **** 	 *\n
  21:App/STM32F4-Discovery/spi.c **** 	 * - WIZNET setup 
  22:App/STM32F4-Discovery/spi.c **** 	 *   	+ IT PC4 
  23:App/STM32F4-Discovery/spi.c **** 	 * */
  24:App/STM32F4-Discovery/spi.c **** 	GPIO_InitTypeDef GPIO_InitStruct;
  25:App/STM32F4-Discovery/spi.c **** 	SPI_InitTypeDef SPI_InitStruct;
  26:App/STM32F4-Discovery/spi.c **** 	DMA_InitTypeDef DMA_InitStruct;
  27:App/STM32F4-Discovery/spi.c **** 	NVIC_InitTypeDef NVIC_InitStruct;
  28:App/STM32F4-Discovery/spi.c **** 
  29:App/STM32F4-Discovery/spi.c **** 	
  30:App/STM32F4-Discovery/spi.c **** 	
  31:App/STM32F4-Discovery/spi.c **** 	// enable clock for used IO pins
  32:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_MOSI_GPIO_CLK, ENABLE);
  57              		.loc 1 32 0
  58 0006 0120     		movs	r0, #1
  59 0008 0121     		movs	r1, #1
  60 000a FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  33:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_MISO_GPIO_CLK, ENABLE);
  61              		.loc 1 33 0
  62 000e 0120     		movs	r0, #1
  63 0010 0121     		movs	r1, #1
  64 0012 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  34:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_SCK_GPIO_CLK, ENABLE);
  65              		.loc 1 34 0
  66 0016 0120     		movs	r0, #1
  67 0018 0121     		movs	r1, #1
  68 001a FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  35:App/STM32F4-Discovery/spi.c **** 	
  36:App/STM32F4-Discovery/spi.c **** 	/* configure pins used by SPI1
  37:App/STM32F4-Discovery/spi.c **** 	 * PA5 = SCK
  38:App/STM32F4-Discovery/spi.c **** 	 * PA6 = MISO
  39:App/STM32F4-Discovery/spi.c **** 	 * PA7 = MOSI
  40:App/STM32F4-Discovery/spi.c **** 	 */
  41:App/STM32F4-Discovery/spi.c **** 	// MOSI PA7
  42:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MOSI_PIN ;
  69              		.loc 1 42 0
  70 001e 8023     		movs	r3, #128
  71 0020 3B66     		str	r3, [r7, #96]
  43:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  72              		.loc 1 43 0
  73 0022 0223     		movs	r3, #2
  74 0024 87F86430 		strb	r3, [r7, #100]
  44:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
  75              		.loc 1 44 0
  76 0028 0023     		movs	r3, #0
  77 002a 87F86630 		strb	r3, [r7, #102]
  45:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
  78              		.loc 1 45 0
  79 002e 0323     		movs	r3, #3
  80 0030 87F86530 		strb	r3, [r7, #101]
  46:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
  81              		.loc 1 46 0
  82 0034 0223     		movs	r3, #2
  83 0036 87F86730 		strb	r3, [r7, #103]
  47:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_MOSI_GPIO_PORT, &GPIO_InitStruct);
  84              		.loc 1 47 0
  85 003a 07F16003 		add	r3, r7, #96
  86 003e B148     		ldr	r0, .L4
  87 0040 1946     		mov	r1, r3
  88 0042 FFF7FEFF 		bl	GPIO_Init
  48:App/STM32F4-Discovery/spi.c **** 	// SCK PA5
  49:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_SCK_PIN;
  89              		.loc 1 49 0
  90 0046 2023     		movs	r3, #32
  91 0048 3B66     		str	r3, [r7, #96]
  50:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  92              		.loc 1 50 0
  93 004a 0223     		movs	r3, #2
  94 004c 87F86430 		strb	r3, [r7, #100]
  51:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
  95              		.loc 1 51 0
  96 0050 0023     		movs	r3, #0
  97 0052 87F86630 		strb	r3, [r7, #102]
  52:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
  98              		.loc 1 52 0
  99 0056 0323     		movs	r3, #3
 100 0058 87F86530 		strb	r3, [r7, #101]
  53:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
 101              		.loc 1 53 0
 102 005c 0223     		movs	r3, #2
 103 005e 87F86730 		strb	r3, [r7, #103]
  54:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_SCK_GPIO_PORT, &GPIO_InitStruct);
 104              		.loc 1 54 0
 105 0062 07F16003 		add	r3, r7, #96
 106 0066 A748     		ldr	r0, .L4
 107 0068 1946     		mov	r1, r3
 108 006a FFF7FEFF 		bl	GPIO_Init
  55:App/STM32F4-Discovery/spi.c **** 	// MISO PA6
  56:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MISO_PIN;
 109              		.loc 1 56 0
 110 006e 4023     		movs	r3, #64
 111 0070 3B66     		str	r3, [r7, #96]
  57:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
 112              		.loc 1 57 0
 113 0072 0223     		movs	r3, #2
 114 0074 87F86430 		strb	r3, [r7, #100]
  58:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_OD;
 115              		.loc 1 58 0
 116 0078 0123     		movs	r3, #1
 117 007a 87F86630 		strb	r3, [r7, #102]
  59:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 118              		.loc 1 59 0
 119 007e 0323     		movs	r3, #3
 120 0080 87F86530 		strb	r3, [r7, #101]
  60:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
 121              		.loc 1 60 0
 122 0084 0023     		movs	r3, #0
 123 0086 87F86730 		strb	r3, [r7, #103]
  61:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_MISO_GPIO_PORT, &GPIO_InitStruct);
 124              		.loc 1 61 0
 125 008a 07F16003 		add	r3, r7, #96
 126 008e 9D48     		ldr	r0, .L4
 127 0090 1946     		mov	r1, r3
 128 0092 FFF7FEFF 		bl	GPIO_Init
  62:App/STM32F4-Discovery/spi.c **** 	
  63:App/STM32F4-Discovery/spi.c **** 	// connect SPI1 pins to SPI alternate function
  64:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_MISO_GPIO_PORT, SPIx_MISO_SOURCE, SPIx_MISO_AF);
 129              		.loc 1 64 0
 130 0096 9B48     		ldr	r0, .L4
 131 0098 0621     		movs	r1, #6
 132 009a 0522     		movs	r2, #5
 133 009c FFF7FEFF 		bl	GPIO_PinAFConfig
  65:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_MOSI_GPIO_PORT, SPIx_MOSI_SOURCE, SPIx_MOSI_AF);
 134              		.loc 1 65 0
 135 00a0 9848     		ldr	r0, .L4
 136 00a2 0721     		movs	r1, #7
 137 00a4 0522     		movs	r2, #5
 138 00a6 FFF7FEFF 		bl	GPIO_PinAFConfig
  66:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_SCK_GPIO_PORT,  SPIx_SCK_SOURCE,  SPIx_SCK_AF);
 139              		.loc 1 66 0
 140 00aa 9648     		ldr	r0, .L4
 141 00ac 0521     		movs	r1, #5
 142 00ae 0522     		movs	r2, #5
 143 00b0 FFF7FEFF 		bl	GPIO_PinAFConfig
  67:App/STM32F4-Discovery/spi.c **** 
  68:App/STM32F4-Discovery/spi.c **** 
  69:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(WIZ_HR_GPIO_CLK, ENABLE);
 144              		.loc 1 69 0
 145 00b4 0420     		movs	r0, #4
 146 00b6 0121     		movs	r1, #1
 147 00b8 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  70:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(WIZ_IT_GPIO_CLK, ENABLE);
 148              		.loc 1 70 0
 149 00bc 0420     		movs	r0, #4
 150 00be 0121     		movs	r1, #1
 151 00c0 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  71:App/STM32F4-Discovery/spi.c **** 	
  72:App/STM32F4-Discovery/spi.c **** 		
  73:App/STM32F4-Discovery/spi.c **** 	/* Configure the chip select pin
  74:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA4 */
  75:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_CS_PIN;
 152              		.loc 1 75 0
 153 00c4 1023     		movs	r3, #16
 154 00c6 3B66     		str	r3, [r7, #96]
  76:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 155              		.loc 1 76 0
 156 00c8 0123     		movs	r3, #1
 157 00ca 87F86430 		strb	r3, [r7, #100]
  77:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 158              		.loc 1 77 0
 159 00ce 0023     		movs	r3, #0
 160 00d0 87F86630 		strb	r3, [r7, #102]
  78:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 161              		.loc 1 78 0
 162 00d4 0323     		movs	r3, #3
 163 00d6 87F86530 		strb	r3, [r7, #101]
  79:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 164              		.loc 1 79 0
 165 00da 0123     		movs	r3, #1
 166 00dc 87F86730 		strb	r3, [r7, #103]
  80:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_CS_GPIO_PORT, &GPIO_InitStruct);
 167              		.loc 1 80 0
 168 00e0 07F16003 		add	r3, r7, #96
 169 00e4 8748     		ldr	r0, .L4
 170 00e6 1946     		mov	r1, r3
 171 00e8 FFF7FEFF 		bl	GPIO_Init
  81:App/STM32F4-Discovery/spi.c **** 	
  82:App/STM32F4-Discovery/spi.c **** 	CSOFF(); // set PA4 high
 172              		.loc 1 82 0
 173 00ec 854B     		ldr	r3, .L4
 174 00ee 854A     		ldr	r2, .L4
 175 00f0 128B     		ldrh	r2, [r2, #24]	@ movhi
 176 00f2 92B2     		uxth	r2, r2
 177 00f4 42F01002 		orr	r2, r2, #16
 178 00f8 92B2     		uxth	r2, r2
 179 00fa 1A83     		strh	r2, [r3, #24]	@ movhi
  83:App/STM32F4-Discovery/spi.c **** 
  84:App/STM32F4-Discovery/spi.c **** 	/* Configure the hard reset pin
  85:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA3 */
  86:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = WIZ_HR_PIN;
 180              		.loc 1 86 0
 181 00fc 2023     		movs	r3, #32
 182 00fe 3B66     		str	r3, [r7, #96]
  87:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 183              		.loc 1 87 0
 184 0100 0123     		movs	r3, #1
 185 0102 87F86430 		strb	r3, [r7, #100]
  88:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 186              		.loc 1 88 0
 187 0106 0023     		movs	r3, #0
 188 0108 87F86630 		strb	r3, [r7, #102]
  89:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 189              		.loc 1 89 0
 190 010c 0323     		movs	r3, #3
 191 010e 87F86530 		strb	r3, [r7, #101]
  90:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 192              		.loc 1 90 0
 193 0112 0123     		movs	r3, #1
 194 0114 87F86730 		strb	r3, [r7, #103]
  91:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(WIZ_HR_GPIO_PORT, &GPIO_InitStruct);
 195              		.loc 1 91 0
 196 0118 07F16003 		add	r3, r7, #96
 197 011c 7A48     		ldr	r0, .L4+4
 198 011e 1946     		mov	r1, r3
 199 0120 FFF7FEFF 		bl	GPIO_Init
  92:App/STM32F4-Discovery/spi.c **** 	
  93:App/STM32F4-Discovery/spi.c **** 	RESET_LOW(); // set PA3 high
 200              		.loc 1 93 0
 201 0124 784B     		ldr	r3, .L4+4
 202 0126 784A     		ldr	r2, .L4+4
 203 0128 128B     		ldrh	r2, [r2, #24]	@ movhi
 204 012a 92B2     		uxth	r2, r2
 205 012c 42F02002 		orr	r2, r2, #32
 206 0130 92B2     		uxth	r2, r2
 207 0132 1A83     		strh	r2, [r3, #24]	@ movhi
  94:App/STM32F4-Discovery/spi.c **** 
  95:App/STM32F4-Discovery/spi.c **** 	// enable peripheral clock
  96:App/STM32F4-Discovery/spi.c **** 	RCC_APB2PeriphClockCmd(SPIx_CLK, ENABLE);
 208              		.loc 1 96 0
 209 0134 4FF48050 		mov	r0, #4096
 210 0138 0121     		movs	r1, #1
 211 013a FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  97:App/STM32F4-Discovery/spi.c **** 	
  98:App/STM32F4-Discovery/spi.c **** 	/* configure SPI1 in Mode 0 
  99:App/STM32F4-Discovery/spi.c **** 	 * CPOL = 0 --> clock is low when idle
 100:App/STM32F4-Discovery/spi.c **** 	 * CPHA = 0 --> data is sampled at the first edge
 101:App/STM32F4-Discovery/spi.c **** 	 */
 102:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Direction = SPI_Direction_2Lines_FullDuplex; // set to full duplex mode, sepera
 212              		.loc 1 102 0
 213 013e 0023     		movs	r3, #0
 214 0140 A7F84C30 		strh	r3, [r7, #76]	@ movhi
 103:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Mode = SPI_Mode_Master;     // transmit in master mode, NSS pin has to be alway
 215              		.loc 1 103 0
 216 0144 4FF48273 		mov	r3, #260
 217 0148 A7F84E30 		strh	r3, [r7, #78]	@ movhi
 104:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_DataSize = SPI_DataSize_8b; // one packet of data is 8 bits wide
 218              		.loc 1 104 0
 219 014c 0023     		movs	r3, #0
 220 014e A7F85030 		strh	r3, [r7, #80]	@ movhi
 105:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPOL = SPI_CPOL_Low;        // clock is low when idle
 221              		.loc 1 105 0
 222 0152 0023     		movs	r3, #0
 223 0154 A7F85230 		strh	r3, [r7, #82]	@ movhi
 106:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPHA = SPI_CPHA_1Edge;      // data sampled at second edge
 224              		.loc 1 106 0
 225 0158 0023     		movs	r3, #0
 226 015a A7F85430 		strh	r3, [r7, #84]	@ movhi
 107:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_NSS = SPI_NSS_Soft | SPI_NSSInternalSoft_Set; // set the NSS management to inte
 227              		.loc 1 107 0
 228 015e 4FF44073 		mov	r3, #768
 229 0162 A7F85630 		strh	r3, [r7, #86]	@ movhi
 108:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_4; // SPI frequency is APB2 frequency
 230              		.loc 1 108 0
 231 0166 0823     		movs	r3, #8
 232 0168 A7F85830 		strh	r3, [r7, #88]	@ movhi
 109:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_FirstBit = SPI_FirstBit_MSB;// data is transmitted MSB first
 233              		.loc 1 109 0
 234 016c 0023     		movs	r3, #0
 235 016e A7F85A30 		strh	r3, [r7, #90]	@ movhi
 110:App/STM32F4-Discovery/spi.c **** 	SPI_Init(SPIx, &SPI_InitStruct); 
 236              		.loc 1 110 0
 237 0172 07F14C03 		add	r3, r7, #76
 238 0176 6548     		ldr	r0, .L4+8
 239 0178 1946     		mov	r1, r3
 240 017a FFF7FEFF 		bl	SPI_Init
 111:App/STM32F4-Discovery/spi.c **** 	
 112:App/STM32F4-Discovery/spi.c **** 	SPI_Cmd(SPIx, ENABLE);			
 241              		.loc 1 112 0
 242 017e 6348     		ldr	r0, .L4+8
 243 0180 0121     		movs	r1, #1
 244 0182 FFF7FEFF 		bl	SPI_Cmd
 113:App/STM32F4-Discovery/spi.c **** 	
 114:App/STM32F4-Discovery/spi.c **** 
 115:App/STM32F4-Discovery/spi.c **** 	/* setup DMA */
 116:App/STM32F4-Discovery/spi.c **** 
 117:App/STM32F4-Discovery/spi.c **** 	// enable clock 
 118:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd (SPIx_DMA_CLK, ENABLE); 
 245              		.loc 1 118 0
 246 0186 4FF48000 		mov	r0, #4194304
 247 018a 0121     		movs	r1, #1
 248 018c FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
 119:App/STM32F4-Discovery/spi.c **** 	
 120:App/STM32F4-Discovery/spi.c **** 	// start with blank DMA configuration
 121:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_TX_DMA_STREAM);
 249              		.loc 1 121 0
 250 0190 5F48     		ldr	r0, .L4+12
 251 0192 FFF7FEFF 		bl	DMA_DeInit
 122:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_RX_DMA_STREAM);
 252              		.loc 1 122 0
 253 0196 5F48     		ldr	r0, .L4+16
 254 0198 FFF7FEFF 		bl	DMA_DeInit
 123:App/STM32F4-Discovery/spi.c **** 
 124:App/STM32F4-Discovery/spi.c **** 	// check if DMA stream is disabled before enabling 
 125:App/STM32F4-Discovery/spi.c **** 	// this is useful when stream is enabled and disabled multiple times. 
 126:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_TX_DMA_STREAM) != DISABLE);
 255              		.loc 1 126 0
 256 019c 00BF     		nop
 257              	.L2:
 258              		.loc 1 126 0 is_stmt 0 discriminator 1
 259 019e 5C48     		ldr	r0, .L4+12
 260 01a0 FFF7FEFF 		bl	DMA_GetCmdStatus
 261 01a4 0346     		mov	r3, r0
 262 01a6 002B     		cmp	r3, #0
 263 01a8 F9D1     		bne	.L2
 127:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_RX_DMA_STREAM) != DISABLE);
 264              		.loc 1 127 0 is_stmt 1
 265 01aa 00BF     		nop
 266              	.L3:
 267              		.loc 1 127 0 is_stmt 0 discriminator 1
 268 01ac 5948     		ldr	r0, .L4+16
 269 01ae FFF7FEFF 		bl	DMA_GetCmdStatus
 270 01b2 0346     		mov	r3, r0
 271 01b4 002B     		cmp	r3, #0
 272 01b6 F9D1     		bne	.L3
 128:App/STM32F4-Discovery/spi.c **** 	
 129:App/STM32F4-Discovery/spi.c **** 	
 130:App/STM32F4-Discovery/spi.c **** 	DMA_StructInit(&DMA_InitStruct);
 273              		.loc 1 130 0 is_stmt 1
 274 01b8 07F11003 		add	r3, r7, #16
 275 01bc 1846     		mov	r0, r3
 276 01be FFF7FEFF 		bl	DMA_StructInit
 131:App/STM32F4-Discovery/spi.c ****   	//Configure DMA Initialization Structure
 132:App/STM32F4-Discovery/spi.c **** 	//DMA_InitStruct.DMA_FIFOMode = DMA_FIFOMode_Disable ;
 133:App/STM32F4-Discovery/spi.c ****  	//DMA_InitStruct.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull ;
 134:App/STM32F4-Discovery/spi.c ****   	//DMA_InitStruct.DMA_MemoryBurst = DMA_MemoryBurst_Single ;
 135:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;
 277              		.loc 1 135 0
 278 01c2 0023     		movs	r3, #0
 279 01c4 3B63     		str	r3, [r7, #48]
 136:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryInc = DMA_MemoryInc_Enable;
 280              		.loc 1 136 0
 281 01c6 4FF48063 		mov	r3, #1024
 282 01ca BB62     		str	r3, [r7, #40]
 137:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Mode = DMA_Mode_Normal;
 283              		.loc 1 137 0
 284 01cc 0023     		movs	r3, #0
 285 01ce 7B63     		str	r3, [r7, #52]
 138:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBaseAddr =(uint32_t) (&(SPIx->DR)) ;
 286              		.loc 1 138 0
 287 01d0 514B     		ldr	r3, .L4+20
 288 01d2 7B61     		str	r3, [r7, #20]
 139:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
 289              		.loc 1 139 0
 290 01d4 0023     		movs	r3, #0
 291 01d6 BB64     		str	r3, [r7, #72]
 140:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;
 292              		.loc 1 140 0
 293 01d8 0023     		movs	r3, #0
 294 01da FB62     		str	r3, [r7, #44]
 141:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
 295              		.loc 1 141 0
 296 01dc 0023     		movs	r3, #0
 297 01de 7B62     		str	r3, [r7, #36]
 142:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Priority = DMA_Priority_High;
 298              		.loc 1 142 0
 299 01e0 4FF40033 		mov	r3, #131072
 300 01e4 BB63     		str	r3, [r7, #56]
 143:App/STM32F4-Discovery/spi.c ****   	// Configure TX DMA 
 144:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Channel = SPIx_TX_DMA_CHANNEL ;
 301              		.loc 1 144 0
 302 01e6 4FF0C063 		mov	r3, #100663296
 303 01ea 3B61     		str	r3, [r7, #16]
 145:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_DIR = DMA_DIR_MemoryToPeripheral ;
 304              		.loc 1 145 0
 305 01ec 4023     		movs	r3, #64
 306 01ee FB61     		str	r3, [r7, #28]
 146:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t) &bufferTX ;
 307              		.loc 1 146 0
 308 01f0 4A4B     		ldr	r3, .L4+24
 309 01f2 BB61     		str	r3, [r7, #24]
 147:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 310              		.loc 1 147 0
 311 01f4 4FF4FA63 		mov	r3, #2000
 312 01f8 3B62     		str	r3, [r7, #32]
 148:App/STM32F4-Discovery/spi.c ****   	DMA_Init(SPIx_TX_DMA_STREAM, &DMA_InitStruct);
 313              		.loc 1 148 0
 314 01fa 07F11003 		add	r3, r7, #16
 315 01fe 4448     		ldr	r0, .L4+12
 316 0200 1946     		mov	r1, r3
 317 0202 FFF7FEFF 		bl	DMA_Init
 149:App/STM32F4-Discovery/spi.c **** 	// Configure RX DMA 
 150:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Channel = SPIx_RX_DMA_CHANNEL ;
 318              		.loc 1 150 0
 319 0206 4FF0C063 		mov	r3, #100663296
 320 020a 3B61     		str	r3, [r7, #16]
 151:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_DIR = DMA_DIR_PeripheralToMemory ;
 321              		.loc 1 151 0
 322 020c 0023     		movs	r3, #0
 323 020e FB61     		str	r3, [r7, #28]
 152:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t)&bufferRX; 
 324              		.loc 1 152 0
 325 0210 434B     		ldr	r3, .L4+28
 326 0212 BB61     		str	r3, [r7, #24]
 153:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 327              		.loc 1 153 0
 328 0214 4FF4FA63 		mov	r3, #2000
 329 0218 3B62     		str	r3, [r7, #32]
 154:App/STM32F4-Discovery/spi.c **** 	DMA_Init(SPIx_RX_DMA_STREAM, &DMA_InitStruct);	
 330              		.loc 1 154 0
 331 021a 07F11003 		add	r3, r7, #16
 332 021e 3D48     		ldr	r0, .L4+16
 333 0220 1946     		mov	r1, r3
 334 0222 FFF7FEFF 		bl	DMA_Init
 155:App/STM32F4-Discovery/spi.c **** 	
 156:App/STM32F4-Discovery/spi.c **** 	DMA_ITConfig(SPIx_TX_DMA_STREAM, DMA_IT_TC, ENABLE); 
 335              		.loc 1 156 0
 336 0226 3A48     		ldr	r0, .L4+12
 337 0228 1021     		movs	r1, #16
 338 022a 0122     		movs	r2, #1
 339 022c FFF7FEFF 		bl	DMA_ITConfig
 157:App/STM32F4-Discovery/spi.c **** 	DMA_ITConfig(SPIx_RX_DMA_STREAM, DMA_IT_TC, ENABLE); 
 340              		.loc 1 157 0
 341 0230 3848     		ldr	r0, .L4+16
 342 0232 1021     		movs	r1, #16
 343 0234 0122     		movs	r2, #1
 344 0236 FFF7FEFF 		bl	DMA_ITConfig
 158:App/STM32F4-Discovery/spi.c ****   
 159:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_TXE);
 345              		.loc 1 159 0
 346 023a 3448     		ldr	r0, .L4+8
 347 023c 0221     		movs	r1, #2
 348 023e FFF7FEFF 		bl	SPI_I2S_ClearFlag
 160:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_RXNE);
 349              		.loc 1 160 0
 350 0242 3248     		ldr	r0, .L4+8
 351 0244 0121     		movs	r1, #1
 352 0246 FFF7FEFF 		bl	SPI_I2S_ClearFlag
 161:App/STM32F4-Discovery/spi.c ****   	
 162:App/STM32F4-Discovery/spi.c **** 	// enable the interrupt in the NVIC
 163:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannel = SPIx_TX_DMA_IRQn;
 353              		.loc 1 163 0
 354 024a 3B23     		movs	r3, #59
 355 024c 3B73     		strb	r3, [r7, #12]
 164:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY
 356              		.loc 1 164 0
 357 024e 0723     		movs	r3, #7
 358 0250 7B73     		strb	r3, [r7, #13]
 165:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0x1;
 359              		.loc 1 165 0
 360 0252 0123     		movs	r3, #1
 361 0254 BB73     		strb	r3, [r7, #14]
 166:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 362              		.loc 1 166 0
 363 0256 0123     		movs	r3, #1
 364 0258 FB73     		strb	r3, [r7, #15]
 167:App/STM32F4-Discovery/spi.c ****   	NVIC_Init (&NVIC_InitStruct);
 365              		.loc 1 167 0
 366 025a 07F10C03 		add	r3, r7, #12
 367 025e 1846     		mov	r0, r3
 368 0260 FFF7FEFF 		bl	NVIC_Init
 168:App/STM32F4-Discovery/spi.c **** 	// enable the interrupt in the NVIC
 169:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannel = SPIx_RX_DMA_IRQn;
 369              		.loc 1 169 0
 370 0264 3A23     		movs	r3, #58
 371 0266 3B73     		strb	r3, [r7, #12]
 170:App/STM32F4-Discovery/spi.c ****    	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORIT
 372              		.loc 1 170 0
 373 0268 0723     		movs	r3, #7
 374 026a 7B73     		strb	r3, [r7, #13]
 171:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0x1;
 375              		.loc 1 171 0
 376 026c 0123     		movs	r3, #1
 377 026e BB73     		strb	r3, [r7, #14]
 172:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 378              		.loc 1 172 0
 379 0270 0123     		movs	r3, #1
 380 0272 FB73     		strb	r3, [r7, #15]
 173:App/STM32F4-Discovery/spi.c ****   	NVIC_Init (&NVIC_InitStruct);
 381              		.loc 1 173 0
 382 0274 07F10C03 		add	r3, r7, #12
 383 0278 1846     		mov	r0, r3
 384 027a FFF7FEFF 		bl	NVIC_Init
 174:App/STM32F4-Discovery/spi.c ****   	// Enable dma tx and rx request
 175:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Tx, ENABLE);	
 385              		.loc 1 175 0
 386 027e 2348     		ldr	r0, .L4+8
 387 0280 0221     		movs	r1, #2
 388 0282 0122     		movs	r2, #1
 389 0284 FFF7FEFF 		bl	SPI_I2S_DMACmd
 176:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Rx, ENABLE);	
 390              		.loc 1 176 0
 391 0288 2048     		ldr	r0, .L4+8
 392 028a 0121     		movs	r1, #1
 393 028c 0122     		movs	r2, #1
 394 028e FFF7FEFF 		bl	SPI_I2S_DMACmd
 177:App/STM32F4-Discovery/spi.c **** 	
 178:App/STM32F4-Discovery/spi.c **** 
 179:App/STM32F4-Discovery/spi.c **** 	/* Configure interrupt pin */
 180:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = WIZ_IT_PIN;
 395              		.loc 1 180 0
 396 0292 1023     		movs	r3, #16
 397 0294 3B66     		str	r3, [r7, #96]
 181:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IN;
 398              		.loc 1 181 0
 399 0296 0023     		movs	r3, #0
 400 0298 87F86430 		strb	r3, [r7, #100]
 182:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 401              		.loc 1 182 0
 402 029c 0023     		movs	r3, #0
 403 029e 87F86630 		strb	r3, [r7, #102]
 183:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
 404              		.loc 1 183 0
 405 02a2 0023     		movs	r3, #0
 406 02a4 87F86730 		strb	r3, [r7, #103]
 184:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 407              		.loc 1 184 0
 408 02a8 0323     		movs	r3, #3
 409 02aa 87F86530 		strb	r3, [r7, #101]
 185:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(WIZ_IT_GPIO_PORT, &GPIO_InitStruct);	
 410              		.loc 1 185 0
 411 02ae 07F16003 		add	r3, r7, #96
 412 02b2 1548     		ldr	r0, .L4+4
 413 02b4 1946     		mov	r1, r3
 414 02b6 FFF7FEFF 		bl	GPIO_Init
 186:App/STM32F4-Discovery/spi.c **** 	
 187:App/STM32F4-Discovery/spi.c **** 	EXTI_InitTypeDef EXTI_InitStruct;
 188:App/STM32F4-Discovery/spi.c **** 	NVIC_InitTypeDef NVIC_InitStruct1;
 189:App/STM32F4-Discovery/spi.c **** 	/* Connect EXTI Line to appropriate GPIO Pin */ 
 190:App/STM32F4-Discovery/spi.c **** 	
 191:App/STM32F4-Discovery/spi.c **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);
 415              		.loc 1 191 0
 416 02ba 4FF48040 		mov	r0, #16384
 417 02be 0121     		movs	r1, #1
 418 02c0 FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
 192:App/STM32F4-Discovery/spi.c **** 
 193:App/STM32F4-Discovery/spi.c **** 	SYSCFG_EXTILineConfig(WIZ_IT_EXTI_PORT_SOURCE, WIZ_IT_EXTI_PIN_SOURCE);
 419              		.loc 1 193 0
 420 02c4 0220     		movs	r0, #2
 421 02c6 0421     		movs	r1, #4
 422 02c8 FFF7FEFF 		bl	SYSCFG_EXTILineConfig
 194:App/STM32F4-Discovery/spi.c **** 	
 195:App/STM32F4-Discovery/spi.c **** 	/* Configure EXTI Line */
 196:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Line = WIZ_IT_EXTI_LINE;
 423              		.loc 1 196 0
 424 02cc 1023     		movs	r3, #16
 425 02ce 7B60     		str	r3, [r7, #4]
 197:App/STM32F4-Discovery/spi.c ****  	EXTI_InitStruct.EXTI_Mode = EXTI_Mode_Interrupt;
 426              		.loc 1 197 0
 427 02d0 0023     		movs	r3, #0
 428 02d2 3B72     		strb	r3, [r7, #8]
 198:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Trigger = EXTI_Trigger_Falling;
 429              		.loc 1 198 0
 430 02d4 0C23     		movs	r3, #12
 431 02d6 7B72     		strb	r3, [r7, #9]
 199:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_LineCmd = ENABLE;
 432              		.loc 1 199 0
 433 02d8 0123     		movs	r3, #1
 434 02da BB72     		strb	r3, [r7, #10]
 200:App/STM32F4-Discovery/spi.c **** 	EXTI_Init(&EXTI_InitStruct);
 435              		.loc 1 200 0
 436 02dc 3B1D     		adds	r3, r7, #4
 437 02de 1846     		mov	r0, r3
 438 02e0 FFF7FEFF 		bl	EXTI_Init
 201:App/STM32F4-Discovery/spi.c ****  	
 202:App/STM32F4-Discovery/spi.c ****  	/* Enable and set EXTI Line Interrupt */
 203:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct1.NVIC_IRQChannel = WIZ_IT_EXTI_IRQn;
 439              		.loc 1 203 0
 440 02e4 0A23     		movs	r3, #10
 441 02e6 3B70     		strb	r3, [r7]
 204:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct1.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY
 442              		.loc 1 204 0
 443 02e8 0923     		movs	r3, #9
 444 02ea 7B70     		strb	r3, [r7, #1]
 205:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct1.NVIC_IRQChannelSubPriority = 0x3;
 445              		.loc 1 205 0
 446 02ec 0323     		movs	r3, #3
 447 02ee BB70     		strb	r3, [r7, #2]
 206:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct1.NVIC_IRQChannelCmd = ENABLE;
 448              		.loc 1 206 0
 449 02f0 0123     		movs	r3, #1
 450 02f2 FB70     		strb	r3, [r7, #3]
 207:App/STM32F4-Discovery/spi.c **** 	NVIC_Init(&NVIC_InitStruct1);
 451              		.loc 1 207 0
 452 02f4 3B46     		mov	r3, r7
 453 02f6 1846     		mov	r0, r3
 454 02f8 FFF7FEFF 		bl	NVIC_Init
 208:App/STM32F4-Discovery/spi.c **** 
 209:App/STM32F4-Discovery/spi.c **** 
 210:App/STM32F4-Discovery/spi.c **** 	
 211:App/STM32F4-Discovery/spi.c **** }
 455              		.loc 1 211 0
 456 02fc 6837     		adds	r7, r7, #104
 457 02fe BD46     		mov	sp, r7
 458              		@ sp needed
 459 0300 80BD     		pop	{r7, pc}
 460              	.L5:
 461 0302 00BF     		.align	2
 462              	.L4:
 463 0304 00000240 		.word	1073872896
 464 0308 00080240 		.word	1073874944
 465 030c 00300140 		.word	1073819648
 466 0310 58640240 		.word	1073898584
 467 0314 40640240 		.word	1073898560
 468 0318 0C300140 		.word	1073819660
 469 031c 00000000 		.word	bufferTX
 470 0320 00000000 		.word	bufferRX
 471              		.cfi_endproc
 472              	.LFE110:
 474              		.section	.text.DMA2_Stream2_IRQHandler,"ax",%progbits
 475              		.align	2
 476              		.global	DMA2_Stream2_IRQHandler
 477              		.thumb
 478              		.thumb_func
 480              	DMA2_Stream2_IRQHandler:
 481              	.LFB111:
 212:App/STM32F4-Discovery/spi.c **** 
 213:App/STM32F4-Discovery/spi.c **** void DMA2_Stream2_IRQHandler()
 214:App/STM32F4-Discovery/spi.c **** {
 482              		.loc 1 214 0
 483              		.cfi_startproc
 484              		@ args = 0, pretend = 0, frame = 8
 485              		@ frame_needed = 1, uses_anonymous_args = 0
 486 0000 80B5     		push	{r7, lr}
 487              	.LCFI3:
 488              		.cfi_def_cfa_offset 8
 489              		.cfi_offset 7, -8
 490              		.cfi_offset 14, -4
 491 0002 82B0     		sub	sp, sp, #8
 492              	.LCFI4:
 493              		.cfi_def_cfa_offset 16
 494 0004 00AF     		add	r7, sp, #0
 495              	.LCFI5:
 496              		.cfi_def_cfa_register 7
 215:App/STM32F4-Discovery/spi.c **** 	/*!	\var static unsigned portBASE_TYPE xHigherPriorityTaskWoken
 216:App/STM32F4-Discovery/spi.c **** 	 * 	\brief Indicates if higher priority has been woken
 217:App/STM32F4-Discovery/spi.c **** 	 */
 218:App/STM32F4-Discovery/spi.c **** 
 219:App/STM32F4-Discovery/spi.c **** 	unsigned portBASE_TYPE xHigherPriorityTaskWoken = pdFalse;
 497              		.loc 1 219 0
 498 0006 0023     		movs	r3, #0
 499 0008 7B60     		str	r3, [r7, #4]
 220:App/STM32F4-Discovery/spi.c **** 
 221:App/STM32F4-Discovery/spi.c ****   // Test if DMA Stream Transfer Complete interrupt
 222:App/STM32F4-Discovery/spi.c ****   if (DMA_GetITStatus (SPIx_RX_DMA_STREAM, DMA_IT_TCIF2)) {
 500              		.loc 1 222 0
 501 000a 1D48     		ldr	r0, .L10
 502 000c 1D49     		ldr	r1, .L10+4
 503 000e FFF7FEFF 		bl	DMA_GetITStatus
 504 0012 0346     		mov	r3, r0
 505 0014 002B     		cmp	r3, #0
 506 0016 28D0     		beq	.L7
 223:App/STM32F4-Discovery/spi.c ****     
 224:App/STM32F4-Discovery/spi.c **** 	DMA_ClearITPendingBit (SPIx_RX_DMA_STREAM, DMA_IT_TCIF2);
 507              		.loc 1 224 0
 508 0018 1948     		ldr	r0, .L10
 509 001a 1A49     		ldr	r1, .L10+4
 510 001c FFF7FEFF 		bl	DMA_ClearITPendingBit
 225:App/STM32F4-Discovery/spi.c **** 	
 226:App/STM32F4-Discovery/spi.c **** 	while (SPI_I2S_GetFlagStatus (SPIx, SPI_I2S_FLAG_BSY) == SET);
 511              		.loc 1 226 0
 512 0020 00BF     		nop
 513              	.L8:
 514              		.loc 1 226 0 is_stmt 0 discriminator 1
 515 0022 1948     		ldr	r0, .L10+8
 516 0024 8021     		movs	r1, #128
 517 0026 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 518 002a 0346     		mov	r3, r0
 519 002c 012B     		cmp	r3, #1
 520 002e F8D0     		beq	.L8
 227:App/STM32F4-Discovery/spi.c ****     /*
 228:App/STM32F4-Discovery/spi.c ****      * The DMA stream is disabled in hardware at the end of the transfer
 229:App/STM32F4-Discovery/spi.c ****      * Now we can deselect the display. If more than one peripheral was being run
 230:App/STM32F4-Discovery/spi.c ****      * on this SPI peripheral, we would have to do both/all of them, or work out
 231:App/STM32F4-Discovery/spi.c ****      * which one was active and deselect that one.i
 232:App/STM32F4-Discovery/spi.c **** 	
 233:App/STM32F4-Discovery/spi.c ****      */
 234:App/STM32F4-Discovery/spi.c **** 	CSOFF();
 521              		.loc 1 234 0 is_stmt 1
 522 0030 164B     		ldr	r3, .L10+12
 523 0032 164A     		ldr	r2, .L10+12
 524 0034 128B     		ldrh	r2, [r2, #24]	@ movhi
 525 0036 92B2     		uxth	r2, r2
 526 0038 42F01002 		orr	r2, r2, #16
 527 003c 92B2     		uxth	r2, r2
 528 003e 1A83     		strh	r2, [r3, #24]	@ movhi
 235:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, DISABLE);		
 529              		.loc 1 235 0
 530 0040 1348     		ldr	r0, .L10+16
 531 0042 0021     		movs	r1, #0
 532 0044 FFF7FEFF 		bl	DMA_Cmd
 236:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, DISABLE);		
 533              		.loc 1 236 0
 534 0048 0D48     		ldr	r0, .L10
 535 004a 0021     		movs	r1, #0
 536 004c FFF7FEFF 		bl	DMA_Cmd
 237:App/STM32F4-Discovery/spi.c ****  
 238:App/STM32F4-Discovery/spi.c **** 	taskENTER_CRITICAL(); 
 537              		.loc 1 238 0
 538 0050 FFF7FEFF 		bl	vPortEnterCritical
 239:App/STM32F4-Discovery/spi.c **** //       xSemaphoreGive( xSemaphoreDMASPI);
 240:App/STM32F4-Discovery/spi.c **** 	xSemaphoreGiveFromISR( xSemaphoreDMASPI, &xHigherPriorityTaskWoken );
 539              		.loc 1 240 0
 540 0054 0F4B     		ldr	r3, .L10+20
 541 0056 1A68     		ldr	r2, [r3]
 542 0058 3B1D     		adds	r3, r7, #4
 543 005a 1046     		mov	r0, r2
 544 005c 0021     		movs	r1, #0
 545 005e 1A46     		mov	r2, r3
 546 0060 0023     		movs	r3, #0
 547 0062 FFF7FEFF 		bl	xQueueGenericSendFromISR
 241:App/STM32F4-Discovery/spi.c **** 	taskEXIT_CRITICAL(); //
 548              		.loc 1 241 0
 549 0066 FFF7FEFF 		bl	vPortExitCritical
 550              	.L7:
 242:App/STM32F4-Discovery/spi.c ****   }	
 243:App/STM32F4-Discovery/spi.c ****  portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
 551              		.loc 1 243 0
 552 006a 7B68     		ldr	r3, [r7, #4]
 553 006c 002B     		cmp	r3, #0
 554 006e 03D0     		beq	.L6
 555              		.loc 1 243 0 is_stmt 0 discriminator 1
 556 0070 094B     		ldr	r3, .L10+24
 557 0072 4FF08052 		mov	r2, #268435456
 558 0076 1A60     		str	r2, [r3]
 559              	.L6:
 244:App/STM32F4-Discovery/spi.c **** }
 560              		.loc 1 244 0 is_stmt 1
 561 0078 0837     		adds	r7, r7, #8
 562 007a BD46     		mov	sp, r7
 563              		@ sp needed
 564 007c 80BD     		pop	{r7, pc}
 565              	.L11:
 566 007e 00BF     		.align	2
 567              	.L10:
 568 0080 40640240 		.word	1073898560
 569 0084 00802010 		.word	270565376
 570 0088 00300140 		.word	1073819648
 571 008c 00000240 		.word	1073872896
 572 0090 58640240 		.word	1073898584
 573 0094 00000000 		.word	xSemaphoreDMASPI
 574 0098 04ED00E0 		.word	-536810236
 575              		.cfi_endproc
 576              	.LFE111:
 578              		.section	.text.DMA2_Stream3_IRQHandler,"ax",%progbits
 579              		.align	2
 580              		.global	DMA2_Stream3_IRQHandler
 581              		.thumb
 582              		.thumb_func
 584              	DMA2_Stream3_IRQHandler:
 585              	.LFB112:
 245:App/STM32F4-Discovery/spi.c **** void DMA2_Stream3_IRQHandler()
 246:App/STM32F4-Discovery/spi.c **** {
 586              		.loc 1 246 0
 587              		.cfi_startproc
 588              		@ args = 0, pretend = 0, frame = 8
 589              		@ frame_needed = 1, uses_anonymous_args = 0
 590 0000 80B5     		push	{r7, lr}
 591              	.LCFI6:
 592              		.cfi_def_cfa_offset 8
 593              		.cfi_offset 7, -8
 594              		.cfi_offset 14, -4
 595 0002 82B0     		sub	sp, sp, #8
 596              	.LCFI7:
 597              		.cfi_def_cfa_offset 16
 598 0004 00AF     		add	r7, sp, #0
 599              	.LCFI8:
 600              		.cfi_def_cfa_register 7
 247:App/STM32F4-Discovery/spi.c **** 	/*!	\var static unsigned portBASE_TYPE xHigherPriorityTaskWoken
 248:App/STM32F4-Discovery/spi.c **** 	 * 	\brief Indicates if higher priority has been woken
 249:App/STM32F4-Discovery/spi.c **** 	 */
 250:App/STM32F4-Discovery/spi.c **** 
 251:App/STM32F4-Discovery/spi.c **** 	unsigned portBASE_TYPE xHigherPriorityTaskWoken = pdFalse;
 601              		.loc 1 251 0
 602 0006 0023     		movs	r3, #0
 603 0008 7B60     		str	r3, [r7, #4]
 252:App/STM32F4-Discovery/spi.c **** 
 253:App/STM32F4-Discovery/spi.c ****   // Test if DMA Stream Transfer Complete interrupt
 254:App/STM32F4-Discovery/spi.c ****   if (DMA_GetITStatus (SPIx_TX_DMA_STREAM, DMA_IT_TCIF3)) {
 604              		.loc 1 254 0
 605 000a 1D48     		ldr	r0, .L16
 606 000c 1D49     		ldr	r1, .L16+4
 607 000e FFF7FEFF 		bl	DMA_GetITStatus
 608 0012 0346     		mov	r3, r0
 609 0014 002B     		cmp	r3, #0
 610 0016 28D0     		beq	.L13
 255:App/STM32F4-Discovery/spi.c ****     
 256:App/STM32F4-Discovery/spi.c **** 	DMA_ClearITPendingBit (SPIx_TX_DMA_STREAM, DMA_IT_TCIF3);
 611              		.loc 1 256 0
 612 0018 1948     		ldr	r0, .L16
 613 001a 1A49     		ldr	r1, .L16+4
 614 001c FFF7FEFF 		bl	DMA_ClearITPendingBit
 257:App/STM32F4-Discovery/spi.c **** 	
 258:App/STM32F4-Discovery/spi.c **** 	while (SPI_I2S_GetFlagStatus (SPIx, SPI_I2S_FLAG_BSY) == SET);
 615              		.loc 1 258 0
 616 0020 00BF     		nop
 617              	.L14:
 618              		.loc 1 258 0 is_stmt 0 discriminator 1
 619 0022 1948     		ldr	r0, .L16+8
 620 0024 8021     		movs	r1, #128
 621 0026 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 622 002a 0346     		mov	r3, r0
 623 002c 012B     		cmp	r3, #1
 624 002e F8D0     		beq	.L14
 259:App/STM32F4-Discovery/spi.c ****     /*
 260:App/STM32F4-Discovery/spi.c ****      * The DMA stream is disabled in hardware at the end of the transfer
 261:App/STM32F4-Discovery/spi.c ****      * Now we can deselect the display. If more than one peripheral was being run
 262:App/STM32F4-Discovery/spi.c ****      * on this SPI peripheral, we would have to do both/all of them, or work out
 263:App/STM32F4-Discovery/spi.c ****      * which one was active and deselect that one.i
 264:App/STM32F4-Discovery/spi.c **** 	
 265:App/STM32F4-Discovery/spi.c ****      */
 266:App/STM32F4-Discovery/spi.c **** 	CSOFF();
 625              		.loc 1 266 0 is_stmt 1
 626 0030 164B     		ldr	r3, .L16+12
 627 0032 164A     		ldr	r2, .L16+12
 628 0034 128B     		ldrh	r2, [r2, #24]	@ movhi
 629 0036 92B2     		uxth	r2, r2
 630 0038 42F01002 		orr	r2, r2, #16
 631 003c 92B2     		uxth	r2, r2
 632 003e 1A83     		strh	r2, [r3, #24]	@ movhi
 267:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, DISABLE);		
 633              		.loc 1 267 0
 634 0040 0F48     		ldr	r0, .L16
 635 0042 0021     		movs	r1, #0
 636 0044 FFF7FEFF 		bl	DMA_Cmd
 268:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, DISABLE);		
 637              		.loc 1 268 0
 638 0048 1148     		ldr	r0, .L16+16
 639 004a 0021     		movs	r1, #0
 640 004c FFF7FEFF 		bl	DMA_Cmd
 269:App/STM32F4-Discovery/spi.c ****        
 270:App/STM32F4-Discovery/spi.c **** 	taskENTER_CRITICAL(); 
 641              		.loc 1 270 0
 642 0050 FFF7FEFF 		bl	vPortEnterCritical
 271:App/STM32F4-Discovery/spi.c **** //	 xSemaphoreGive( xSemaphoreDMASPI );
 272:App/STM32F4-Discovery/spi.c **** 	xSemaphoreGiveFromISR( xSemaphoreDMASPI, &xHigherPriorityTaskWoken );
 643              		.loc 1 272 0
 644 0054 0F4B     		ldr	r3, .L16+20
 645 0056 1A68     		ldr	r2, [r3]
 646 0058 3B1D     		adds	r3, r7, #4
 647 005a 1046     		mov	r0, r2
 648 005c 0021     		movs	r1, #0
 649 005e 1A46     		mov	r2, r3
 650 0060 0023     		movs	r3, #0
 651 0062 FFF7FEFF 		bl	xQueueGenericSendFromISR
 273:App/STM32F4-Discovery/spi.c ****  	taskEXIT_CRITICAL();  
 652              		.loc 1 273 0
 653 0066 FFF7FEFF 		bl	vPortExitCritical
 654              	.L13:
 274:App/STM32F4-Discovery/spi.c ****  }
 275:App/STM32F4-Discovery/spi.c ****    portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
 655              		.loc 1 275 0
 656 006a 7B68     		ldr	r3, [r7, #4]
 657 006c 002B     		cmp	r3, #0
 658 006e 03D0     		beq	.L12
 659              		.loc 1 275 0 is_stmt 0 discriminator 1
 660 0070 094B     		ldr	r3, .L16+24
 661 0072 4FF08052 		mov	r2, #268435456
 662 0076 1A60     		str	r2, [r3]
 663              	.L12:
 276:App/STM32F4-Discovery/spi.c **** }
 664              		.loc 1 276 0 is_stmt 1
 665 0078 0837     		adds	r7, r7, #8
 666 007a BD46     		mov	sp, r7
 667              		@ sp needed
 668 007c 80BD     		pop	{r7, pc}
 669              	.L17:
 670 007e 00BF     		.align	2
 671              	.L16:
 672 0080 58640240 		.word	1073898584
 673 0084 00800018 		.word	402685952
 674 0088 00300140 		.word	1073819648
 675 008c 00000240 		.word	1073872896
 676 0090 40640240 		.word	1073898560
 677 0094 00000000 		.word	xSemaphoreDMASPI
 678 0098 04ED00E0 		.word	-536810236
 679              		.cfi_endproc
 680              	.LFE112:
 682              		.section	.text.spi_dma_send,"ax",%progbits
 683              		.align	2
 684              		.global	spi_dma_send
 685              		.thumb
 686              		.thumb_func
 688              	spi_dma_send:
 689              	.LFB113:
 277:App/STM32F4-Discovery/spi.c **** 
 278:App/STM32F4-Discovery/spi.c **** 
 279:App/STM32F4-Discovery/spi.c **** /*---------------------------- Matic Knap 25 Jun 2014 ---------------------*/
 280:App/STM32F4-Discovery/spi.c **** 
 281:App/STM32F4-Discovery/spi.c **** void spi_dma_send(uint16_t address, uint16_t data_len, uint8_t *data_buf)
 282:App/STM32F4-Discovery/spi.c **** {
 690              		.loc 1 282 0
 691              		.cfi_startproc
 692              		@ args = 0, pretend = 0, frame = 24
 693              		@ frame_needed = 1, uses_anonymous_args = 0
 694 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 695              	.LCFI9:
 696              		.cfi_def_cfa_offset 28
 697              		.cfi_offset 4, -28
 698              		.cfi_offset 5, -24
 699              		.cfi_offset 6, -20
 700              		.cfi_offset 7, -16
 701              		.cfi_offset 8, -12
 702              		.cfi_offset 9, -8
 703              		.cfi_offset 14, -4
 704 0004 87B0     		sub	sp, sp, #28
 705              	.LCFI10:
 706              		.cfi_def_cfa_offset 56
 707 0006 00AF     		add	r7, sp, #0
 708              	.LCFI11:
 709              		.cfi_def_cfa_register 7
 710 0008 0B46     		mov	r3, r1
 711 000a 3A60     		str	r2, [r7]
 712 000c 0246     		mov	r2, r0	@ movhi
 713 000e FA80     		strh	r2, [r7, #6]	@ movhi
 714 0010 BB80     		strh	r3, [r7, #4]	@ movhi
 715 0012 6B46     		mov	r3, sp
 716 0014 1E46     		mov	r6, r3
 283:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[data_len+4];
 717              		.loc 1 283 0
 718 0016 BB88     		ldrh	r3, [r7, #4]
 719 0018 191D     		adds	r1, r3, #4
 720 001a 4B1E     		subs	r3, r1, #1
 721 001c 3B61     		str	r3, [r7, #16]
 722 001e 0B46     		mov	r3, r1
 723 0020 1A46     		mov	r2, r3
 724 0022 4FF00003 		mov	r3, #0
 725 0026 4FEAC309 		lsl	r9, r3, #3
 726 002a 49EA5279 		orr	r9, r9, r2, lsr #29
 727 002e 4FEAC208 		lsl	r8, r2, #3
 728 0032 0B46     		mov	r3, r1
 729 0034 1A46     		mov	r2, r3
 730 0036 4FF00003 		mov	r3, #0
 731 003a DD00     		lsls	r5, r3, #3
 732 003c 45EA5275 		orr	r5, r5, r2, lsr #29
 733 0040 D400     		lsls	r4, r2, #3
 734 0042 0B46     		mov	r3, r1
 735 0044 0733     		adds	r3, r3, #7
 736 0046 DB08     		lsrs	r3, r3, #3
 737 0048 DB00     		lsls	r3, r3, #3
 738 004a ADEB030D 		sub	sp, sp, r3
 739 004e 6B46     		mov	r3, sp
 740 0050 0033     		adds	r3, r3, #0
 741 0052 FB60     		str	r3, [r7, #12]
 284:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 742              		.loc 1 284 0
 743 0054 FB88     		ldrh	r3, [r7, #6]
 744 0056 1B0A     		lsrs	r3, r3, #8
 745 0058 9BB2     		uxth	r3, r3
 746 005a DAB2     		uxtb	r2, r3
 747 005c FB68     		ldr	r3, [r7, #12]
 748 005e 1A70     		strb	r2, [r3]
 285:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 749              		.loc 1 285 0
 750 0060 FB88     		ldrh	r3, [r7, #6]	@ movhi
 751 0062 DAB2     		uxtb	r2, r3
 752 0064 FB68     		ldr	r3, [r7, #12]
 753 0066 5A70     		strb	r2, [r3, #1]
 286:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 754              		.loc 1 286 0
 755 0068 BB88     		ldrh	r3, [r7, #4]
 756 006a 03F4FE43 		and	r3, r3, #32512
 757 006e 1B12     		asrs	r3, r3, #8
 758 0070 DBB2     		uxtb	r3, r3
 759 0072 63F07F03 		orn	r3, r3, #127
 760 0076 DBB2     		uxtb	r3, r3
 761 0078 DAB2     		uxtb	r2, r3
 762 007a FB68     		ldr	r3, [r7, #12]
 763 007c 9A70     		strb	r2, [r3, #2]
 287:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 764              		.loc 1 287 0
 765 007e BB88     		ldrh	r3, [r7, #4]	@ movhi
 766 0080 DAB2     		uxtb	r2, r3
 767 0082 FB68     		ldr	r3, [r7, #12]
 768 0084 DA70     		strb	r2, [r3, #3]
 288:App/STM32F4-Discovery/spi.c **** 
 289:App/STM32F4-Discovery/spi.c **** 		int i;
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 769              		.loc 1 290 0
 770 0086 0423     		movs	r3, #4
 771 0088 7B61     		str	r3, [r7, #20]
 772 008a 0BE0     		b	.L19
 773              	.L20:
 291:App/STM32F4-Discovery/spi.c **** 			buffer[i] = (data_buf[i-4]);
 774              		.loc 1 291 0 discriminator 2
 775 008c 7B69     		ldr	r3, [r7, #20]
 776 008e 043B     		subs	r3, r3, #4
 777 0090 3A68     		ldr	r2, [r7]
 778 0092 1344     		add	r3, r3, r2
 779 0094 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 780 0096 F968     		ldr	r1, [r7, #12]
 781 0098 7B69     		ldr	r3, [r7, #20]
 782 009a 0B44     		add	r3, r3, r1
 783 009c 1A70     		strb	r2, [r3]
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 784              		.loc 1 290 0 discriminator 2
 785 009e 7B69     		ldr	r3, [r7, #20]
 786 00a0 0133     		adds	r3, r3, #1
 787 00a2 7B61     		str	r3, [r7, #20]
 788              	.L19:
 290:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 789              		.loc 1 290 0 is_stmt 0 discriminator 1
 790 00a4 BB88     		ldrh	r3, [r7, #4]
 791 00a6 1A1D     		adds	r2, r3, #4
 792 00a8 7B69     		ldr	r3, [r7, #20]
 793 00aa 9A42     		cmp	r2, r3
 794 00ac EEDC     		bgt	.L20
 292:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, data_len + 4);
 795              		.loc 1 292 0 is_stmt 1
 796 00ae BB88     		ldrh	r3, [r7, #4]	@ movhi
 797 00b0 0433     		adds	r3, r3, #4
 798 00b2 9BB2     		uxth	r3, r3
 799 00b4 1248     		ldr	r0, .L21
 800 00b6 1946     		mov	r1, r3
 801 00b8 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 293:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 802              		.loc 1 293 0
 803 00bc 104B     		ldr	r3, .L21
 804 00be FA68     		ldr	r2, [r7, #12]
 805 00c0 DA60     		str	r2, [r3, #12]
 294:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 806              		.loc 1 294 0
 807 00c2 104B     		ldr	r3, .L21+4
 808 00c4 0F4A     		ldr	r2, .L21+4
 809 00c6 528B     		ldrh	r2, [r2, #26]	@ movhi
 810 00c8 92B2     		uxth	r2, r2
 811 00ca 42F01002 		orr	r2, r2, #16
 812 00ce 92B2     		uxth	r2, r2
 813 00d0 5A83     		strh	r2, [r3, #26]	@ movhi
 295:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 814              		.loc 1 295 0
 815 00d2 0B48     		ldr	r0, .L21
 816 00d4 0121     		movs	r1, #1
 817 00d6 FFF7FEFF 		bl	DMA_Cmd
 296:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);	
 818              		.loc 1 296 0
 819 00da 0B48     		ldr	r0, .L21+8
 820 00dc 0121     		movs	r1, #1
 821 00de FFF7FEFF 		bl	DMA_Cmd
 297:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 298:App/STM32F4-Discovery/spi.c ****         	 xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);
 822              		.loc 1 298 0
 823 00e2 0A4B     		ldr	r3, .L21+12
 824 00e4 1B68     		ldr	r3, [r3]
 825 00e6 1846     		mov	r0, r3
 826 00e8 0021     		movs	r1, #0
 827 00ea 4FF0FF32 		mov	r2, #-1
 828 00ee 0023     		movs	r3, #0
 829 00f0 FFF7FEFF 		bl	xQueueGenericReceive
 830 00f4 B546     		mov	sp, r6
 299:App/STM32F4-Discovery/spi.c **** 
 300:App/STM32F4-Discovery/spi.c **** 	//	CSOFF(); // chip deselect 
 301:App/STM32F4-Discovery/spi.c **** 			
 302:App/STM32F4-Discovery/spi.c **** 	
 303:App/STM32F4-Discovery/spi.c **** }
 831              		.loc 1 303 0
 832 00f6 1C37     		adds	r7, r7, #28
 833 00f8 BD46     		mov	sp, r7
 834              		@ sp needed
 835 00fa BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 836              	.L22:
 837 00fe 00BF     		.align	2
 838              	.L21:
 839 0100 58640240 		.word	1073898584
 840 0104 00000240 		.word	1073872896
 841 0108 40640240 		.word	1073898560
 842 010c 00000000 		.word	xSemaphoreDMASPI
 843              		.cfi_endproc
 844              	.LFE113:
 846              		.section	.text.spi_dma_send2B,"ax",%progbits
 847              		.align	2
 848              		.global	spi_dma_send2B
 849              		.thumb
 850              		.thumb_func
 852              	spi_dma_send2B:
 853              	.LFB114:
 304:App/STM32F4-Discovery/spi.c **** 
 305:App/STM32F4-Discovery/spi.c **** void spi_dma_send2B(uint16_t address,  uint16_t data_buf)
 306:App/STM32F4-Discovery/spi.c **** {
 854              		.loc 1 306 0
 855              		.cfi_startproc
 856              		@ args = 0, pretend = 0, frame = 16
 857              		@ frame_needed = 1, uses_anonymous_args = 0
 858 0000 80B5     		push	{r7, lr}
 859              	.LCFI12:
 860              		.cfi_def_cfa_offset 8
 861              		.cfi_offset 7, -8
 862              		.cfi_offset 14, -4
 863 0002 84B0     		sub	sp, sp, #16
 864              	.LCFI13:
 865              		.cfi_def_cfa_offset 24
 866 0004 00AF     		add	r7, sp, #0
 867              	.LCFI14:
 868              		.cfi_def_cfa_register 7
 869 0006 0246     		mov	r2, r0
 870 0008 0B46     		mov	r3, r1
 871 000a FA80     		strh	r2, [r7, #6]	@ movhi
 872 000c BB80     		strh	r3, [r7, #4]	@ movhi
 307:App/STM32F4-Discovery/spi.c **** 	uint8_t buffer[6];
 308:App/STM32F4-Discovery/spi.c **** 	uint16_t data_len = 2;
 873              		.loc 1 308 0
 874 000e 0223     		movs	r3, #2
 875 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 309:App/STM32F4-Discovery/spi.c **** 	buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 876              		.loc 1 309 0
 877 0012 FB88     		ldrh	r3, [r7, #6]
 878 0014 1B0A     		lsrs	r3, r3, #8
 879 0016 9BB2     		uxth	r3, r3
 880 0018 DBB2     		uxtb	r3, r3
 881 001a 3B72     		strb	r3, [r7, #8]
 310:App/STM32F4-Discovery/spi.c **** 	buffer[1] = ((address & 0x00ff)); //address byte 2 
 882              		.loc 1 310 0
 883 001c FB88     		ldrh	r3, [r7, #6]	@ movhi
 884 001e DBB2     		uxtb	r3, r3
 885 0020 7B72     		strb	r3, [r7, #9]
 311:App/STM32F4-Discovery/spi.c **** 	buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 886              		.loc 1 311 0
 887 0022 FB89     		ldrh	r3, [r7, #14]
 888 0024 03F4FE43 		and	r3, r3, #32512
 889 0028 1B12     		asrs	r3, r3, #8
 890 002a DBB2     		uxtb	r3, r3
 891 002c 63F07F03 		orn	r3, r3, #127
 892 0030 DBB2     		uxtb	r3, r3
 893 0032 DBB2     		uxtb	r3, r3
 894 0034 BB72     		strb	r3, [r7, #10]
 312:App/STM32F4-Discovery/spi.c **** 	 buffer[3] = (data_len & 0x00ff);
 895              		.loc 1 312 0
 896 0036 FB89     		ldrh	r3, [r7, #14]	@ movhi
 897 0038 DBB2     		uxtb	r3, r3
 898 003a FB72     		strb	r3, [r7, #11]
 313:App/STM32F4-Discovery/spi.c **** 	 buffer[4] = ((data_buf & 0xff00) >> 8);
 899              		.loc 1 313 0
 900 003c BB88     		ldrh	r3, [r7, #4]
 901 003e 1B0A     		lsrs	r3, r3, #8
 902 0040 9BB2     		uxth	r3, r3
 903 0042 DBB2     		uxtb	r3, r3
 904 0044 3B73     		strb	r3, [r7, #12]
 314:App/STM32F4-Discovery/spi.c **** 	 buffer[5] = (data_buf & 0x00ff);
 905              		.loc 1 314 0
 906 0046 BB88     		ldrh	r3, [r7, #4]	@ movhi
 907 0048 DBB2     		uxtb	r3, r3
 908 004a 7B73     		strb	r3, [r7, #13]
 315:App/STM32F4-Discovery/spi.c **** 	DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 6);
 909              		.loc 1 315 0
 910 004c 1148     		ldr	r0, .L24
 911 004e 0621     		movs	r1, #6
 912 0050 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 316:App/STM32F4-Discovery/spi.c **** 	SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 913              		.loc 1 316 0
 914 0054 0F4B     		ldr	r3, .L24
 915 0056 07F10802 		add	r2, r7, #8
 916 005a DA60     		str	r2, [r3, #12]
 317:App/STM32F4-Discovery/spi.c **** 	CSON(); // chip select 
 917              		.loc 1 317 0
 918 005c 0E4B     		ldr	r3, .L24+4
 919 005e 0E4A     		ldr	r2, .L24+4
 920 0060 528B     		ldrh	r2, [r2, #26]	@ movhi
 921 0062 92B2     		uxth	r2, r2
 922 0064 42F01002 		orr	r2, r2, #16
 923 0068 92B2     		uxth	r2, r2
 924 006a 5A83     		strh	r2, [r3, #26]	@ movhi
 318:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 925              		.loc 1 318 0
 926 006c 0948     		ldr	r0, .L24
 927 006e 0121     		movs	r1, #1
 928 0070 FFF7FEFF 		bl	DMA_Cmd
 319:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);	
 929              		.loc 1 319 0
 930 0074 0948     		ldr	r0, .L24+8
 931 0076 0121     		movs	r1, #1
 932 0078 FFF7FEFF 		bl	DMA_Cmd
 320:App/STM32F4-Discovery/spi.c **** 	/* Block until the semaphore is given */
 321:App/STM32F4-Discovery/spi.c ****         xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 933              		.loc 1 321 0
 934 007c 084B     		ldr	r3, .L24+12
 935 007e 1B68     		ldr	r3, [r3]
 936 0080 1846     		mov	r0, r3
 937 0082 0021     		movs	r1, #0
 938 0084 4FF0FF32 		mov	r2, #-1
 939 0088 0023     		movs	r3, #0
 940 008a FFF7FEFF 		bl	xQueueGenericReceive
 322:App/STM32F4-Discovery/spi.c **** 	
 323:App/STM32F4-Discovery/spi.c **** //	CSOFF(); // chip deselect 
 324:App/STM32F4-Discovery/spi.c **** 			
 325:App/STM32F4-Discovery/spi.c **** }
 941              		.loc 1 325 0
 942 008e 1037     		adds	r7, r7, #16
 943 0090 BD46     		mov	sp, r7
 944              		@ sp needed
 945 0092 80BD     		pop	{r7, pc}
 946              	.L25:
 947              		.align	2
 948              	.L24:
 949 0094 58640240 		.word	1073898584
 950 0098 00000240 		.word	1073872896
 951 009c 40640240 		.word	1073898560
 952 00a0 00000000 		.word	xSemaphoreDMASPI
 953              		.cfi_endproc
 954              	.LFE114:
 956              		.section	.text.spi_dma_sendByte,"ax",%progbits
 957              		.align	2
 958              		.global	spi_dma_sendByte
 959              		.thumb
 960              		.thumb_func
 962              	spi_dma_sendByte:
 963              	.LFB115:
 326:App/STM32F4-Discovery/spi.c **** 
 327:App/STM32F4-Discovery/spi.c **** void spi_dma_sendByte(uint16_t address,  uint8_t data_buf)
 328:App/STM32F4-Discovery/spi.c **** {
 964              		.loc 1 328 0
 965              		.cfi_startproc
 966              		@ args = 0, pretend = 0, frame = 16
 967              		@ frame_needed = 1, uses_anonymous_args = 0
 968 0000 80B5     		push	{r7, lr}
 969              	.LCFI15:
 970              		.cfi_def_cfa_offset 8
 971              		.cfi_offset 7, -8
 972              		.cfi_offset 14, -4
 973 0002 84B0     		sub	sp, sp, #16
 974              	.LCFI16:
 975              		.cfi_def_cfa_offset 24
 976 0004 00AF     		add	r7, sp, #0
 977              	.LCFI17:
 978              		.cfi_def_cfa_register 7
 979 0006 0246     		mov	r2, r0
 980 0008 0B46     		mov	r3, r1
 981 000a FA80     		strh	r2, [r7, #6]	@ movhi
 982 000c 7B71     		strb	r3, [r7, #5]
 329:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[5];
 330:App/STM32F4-Discovery/spi.c **** 		uint16_t data_len=0x1;
 983              		.loc 1 330 0
 984 000e 0123     		movs	r3, #1
 985 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 331:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 986              		.loc 1 331 0
 987 0012 FB88     		ldrh	r3, [r7, #6]
 988 0014 1B0A     		lsrs	r3, r3, #8
 989 0016 9BB2     		uxth	r3, r3
 990 0018 DBB2     		uxtb	r3, r3
 991 001a 3B72     		strb	r3, [r7, #8]
 332:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 992              		.loc 1 332 0
 993 001c FB88     		ldrh	r3, [r7, #6]	@ movhi
 994 001e DBB2     		uxtb	r3, r3
 995 0020 7B72     		strb	r3, [r7, #9]
 333:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 996              		.loc 1 333 0
 997 0022 FB89     		ldrh	r3, [r7, #14]
 998 0024 03F4FE43 		and	r3, r3, #32512
 999 0028 1B12     		asrs	r3, r3, #8
 1000 002a DBB2     		uxtb	r3, r3
 1001 002c 63F07F03 		orn	r3, r3, #127
 1002 0030 DBB2     		uxtb	r3, r3
 1003 0032 DBB2     		uxtb	r3, r3
 1004 0034 BB72     		strb	r3, [r7, #10]
 334:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 1005              		.loc 1 334 0
 1006 0036 FB89     		ldrh	r3, [r7, #14]	@ movhi
 1007 0038 DBB2     		uxtb	r3, r3
 1008 003a FB72     		strb	r3, [r7, #11]
 335:App/STM32F4-Discovery/spi.c **** 		buffer[4] = data_buf ; 
 1009              		.loc 1 335 0
 1010 003c 7B79     		ldrb	r3, [r7, #5]
 1011 003e 3B73     		strb	r3, [r7, #12]
 336:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 5);
 1012              		.loc 1 336 0
 1013 0040 1148     		ldr	r0, .L27
 1014 0042 0521     		movs	r1, #5
 1015 0044 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 337:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 1016              		.loc 1 337 0
 1017 0048 0F4B     		ldr	r3, .L27
 1018 004a 07F10802 		add	r2, r7, #8
 1019 004e DA60     		str	r2, [r3, #12]
 338:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1020              		.loc 1 338 0
 1021 0050 0E4B     		ldr	r3, .L27+4
 1022 0052 0E4A     		ldr	r2, .L27+4
 1023 0054 528B     		ldrh	r2, [r2, #26]	@ movhi
 1024 0056 92B2     		uxth	r2, r2
 1025 0058 42F01002 		orr	r2, r2, #16
 1026 005c 92B2     		uxth	r2, r2
 1027 005e 5A83     		strh	r2, [r3, #26]	@ movhi
 339:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1028              		.loc 1 339 0
 1029 0060 0948     		ldr	r0, .L27
 1030 0062 0121     		movs	r1, #1
 1031 0064 FFF7FEFF 		bl	DMA_Cmd
 340:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1032              		.loc 1 340 0
 1033 0068 0948     		ldr	r0, .L27+8
 1034 006a 0121     		movs	r1, #1
 1035 006c FFF7FEFF 		bl	DMA_Cmd
 341:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 342:App/STM32F4-Discovery/spi.c **** 	        xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 1036              		.loc 1 342 0
 1037 0070 084B     		ldr	r3, .L27+12
 1038 0072 1B68     		ldr	r3, [r3]
 1039 0074 1846     		mov	r0, r3
 1040 0076 0021     		movs	r1, #0
 1041 0078 4FF0FF32 		mov	r2, #-1
 1042 007c 0023     		movs	r3, #0
 1043 007e FFF7FEFF 		bl	xQueueGenericReceive
 343:App/STM32F4-Discovery/spi.c **** 				
 344:App/STM32F4-Discovery/spi.c **** //		CSOFF(); // chip deselect 
 345:App/STM32F4-Discovery/spi.c **** 			
 346:App/STM32F4-Discovery/spi.c **** }
 1044              		.loc 1 346 0
 1045 0082 1037     		adds	r7, r7, #16
 1046 0084 BD46     		mov	sp, r7
 1047              		@ sp needed
 1048 0086 80BD     		pop	{r7, pc}
 1049              	.L28:
 1050              		.align	2
 1051              	.L27:
 1052 0088 58640240 		.word	1073898584
 1053 008c 00000240 		.word	1073872896
 1054 0090 40640240 		.word	1073898560
 1055 0094 00000000 		.word	xSemaphoreDMASPI
 1056              		.cfi_endproc
 1057              	.LFE115:
 1059              		.section	.text.spi_dma_read2B,"ax",%progbits
 1060              		.align	2
 1061              		.global	spi_dma_read2B
 1062              		.thumb
 1063              		.thumb_func
 1065              	spi_dma_read2B:
 1066              	.LFB116:
 347:App/STM32F4-Discovery/spi.c **** 
 348:App/STM32F4-Discovery/spi.c **** 
 349:App/STM32F4-Discovery/spi.c **** uint16_t spi_dma_read2B(uint16_t address)
 350:App/STM32F4-Discovery/spi.c **** {
 1067              		.loc 1 350 0
 1068              		.cfi_startproc
 1069              		@ args = 0, pretend = 0, frame = 24
 1070              		@ frame_needed = 1, uses_anonymous_args = 0
 1071 0000 80B5     		push	{r7, lr}
 1072              	.LCFI18:
 1073              		.cfi_def_cfa_offset 8
 1074              		.cfi_offset 7, -8
 1075              		.cfi_offset 14, -4
 1076 0002 86B0     		sub	sp, sp, #24
 1077              	.LCFI19:
 1078              		.cfi_def_cfa_offset 32
 1079 0004 00AF     		add	r7, sp, #0
 1080              	.LCFI20:
 1081              		.cfi_def_cfa_register 7
 1082 0006 0346     		mov	r3, r0
 1083 0008 FB80     		strh	r3, [r7, #6]	@ movhi
 351:App/STM32F4-Discovery/spi.c **** 		uint16_t data_len = 2; 
 1084              		.loc 1 351 0
 1085 000a 0223     		movs	r3, #2
 1086 000c 7B82     		strh	r3, [r7, #18]	@ movhi
 352:App/STM32F4-Discovery/spi.c **** 		uint8_t data_buf[4];
 353:App/STM32F4-Discovery/spi.c **** 		
 354:App/STM32F4-Discovery/spi.c **** 		data_buf[0] = ((address & 0xff00) >> 8); // addres byte 1 
 1087              		.loc 1 354 0
 1088 000e FB88     		ldrh	r3, [r7, #6]
 1089 0010 1B0A     		lsrs	r3, r3, #8
 1090 0012 9BB2     		uxth	r3, r3
 1091 0014 DBB2     		uxtb	r3, r3
 1092 0016 3B73     		strb	r3, [r7, #12]
 355:App/STM32F4-Discovery/spi.c **** 		data_buf[1] = ((address & 0x00ff)); //address byte 2 
 1093              		.loc 1 355 0
 1094 0018 FB88     		ldrh	r3, [r7, #6]	@ movhi
 1095 001a DBB2     		uxtb	r3, r3
 1096 001c 7B73     		strb	r3, [r7, #13]
 356:App/STM32F4-Discovery/spi.c **** 		data_buf[2] = ((0x00 | (data_len & 0x7f00) >> 8 ));
 1097              		.loc 1 356 0
 1098 001e 7B8A     		ldrh	r3, [r7, #18]
 1099 0020 03F4FE43 		and	r3, r3, #32512
 1100 0024 1B12     		asrs	r3, r3, #8
 1101 0026 DBB2     		uxtb	r3, r3
 1102 0028 BB73     		strb	r3, [r7, #14]
 357:App/STM32F4-Discovery/spi.c **** 		data_buf[3] = (data_len & 0x00ff);
 1103              		.loc 1 357 0
 1104 002a 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1105 002c DBB2     		uxtb	r3, r3
 1106 002e FB73     		strb	r3, [r7, #15]
 358:App/STM32F4-Discovery/spi.c **** 
 359:App/STM32F4-Discovery/spi.c **** 		int i;
 360:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++) data_buf[i] = 0x0;
 1107              		.loc 1 360 0
 1108 0030 0023     		movs	r3, #0
 1109 0032 7B61     		str	r3, [r7, #20]
 1110 0034 08E0     		b	.L30
 1111              	.L31:
 1112              		.loc 1 360 0 is_stmt 0 discriminator 2
 1113 0036 07F10C02 		add	r2, r7, #12
 1114 003a 7B69     		ldr	r3, [r7, #20]
 1115 003c 1344     		add	r3, r3, r2
 1116 003e 0022     		movs	r2, #0
 1117 0040 1A70     		strb	r2, [r3]
 1118 0042 7B69     		ldr	r3, [r7, #20]
 1119 0044 0133     		adds	r3, r3, #1
 1120 0046 7B61     		str	r3, [r7, #20]
 1121              	.L30:
 1122              		.loc 1 360 0 discriminator 1
 1123 0048 7A8A     		ldrh	r2, [r7, #18]
 1124 004a 7B69     		ldr	r3, [r7, #20]
 1125 004c 9A42     		cmp	r2, r3
 1126 004e F2DC     		bgt	.L31
 361:App/STM32F4-Discovery/spi.c **** 
 362:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_RX_DMA_STREAM, data_len+4);
 1127              		.loc 1 362 0 is_stmt 1
 1128 0050 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1129 0052 0433     		adds	r3, r3, #4
 1130 0054 9BB2     		uxth	r3, r3
 1131 0056 1648     		ldr	r0, .L33
 1132 0058 1946     		mov	r1, r3
 1133 005a FFF7FEFF 		bl	DMA_SetCurrDataCounter
 363:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 4+data_len);
 1134              		.loc 1 363 0
 1135 005e 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1136 0060 0433     		adds	r3, r3, #4
 1137 0062 9BB2     		uxth	r3, r3
 1138 0064 1348     		ldr	r0, .L33+4
 1139 0066 1946     		mov	r1, r3
 1140 0068 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 364:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &bufferTX;	
 1141              		.loc 1 364 0
 1142 006c 114B     		ldr	r3, .L33+4
 1143 006e 124A     		ldr	r2, .L33+8
 1144 0070 DA60     		str	r2, [r3, #12]
 365:App/STM32F4-Discovery/spi.c **** 		SPIx_RX_DMA_STREAM->M0AR =(uint32_t)&bufferRX;	
 1145              		.loc 1 365 0
 1146 0072 0F4B     		ldr	r3, .L33
 1147 0074 114A     		ldr	r2, .L33+12
 1148 0076 DA60     		str	r2, [r3, #12]
 366:App/STM32F4-Discovery/spi.c **** 
 367:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1149              		.loc 1 367 0
 1150 0078 114B     		ldr	r3, .L33+16
 1151 007a 114A     		ldr	r2, .L33+16
 1152 007c 528B     		ldrh	r2, [r2, #26]	@ movhi
 1153 007e 92B2     		uxth	r2, r2
 1154 0080 42F01002 		orr	r2, r2, #16
 1155 0084 92B2     		uxth	r2, r2
 1156 0086 5A83     		strh	r2, [r3, #26]	@ movhi
 368:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1157              		.loc 1 368 0
 1158 0088 0A48     		ldr	r0, .L33+4
 1159 008a 0121     		movs	r1, #1
 1160 008c FFF7FEFF 		bl	DMA_Cmd
 369:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1161              		.loc 1 369 0
 1162 0090 0748     		ldr	r0, .L33
 1163 0092 0121     		movs	r1, #1
 1164 0094 FFF7FEFF 		bl	DMA_Cmd
 370:App/STM32F4-Discovery/spi.c **** 		//CSOFF(); // chip deselect		
 371:App/STM32F4-Discovery/spi.c **** 
 372:App/STM32F4-Discovery/spi.c **** 		return (data_buf[0] << 8) | data_buf[1];
 1165              		.loc 1 372 0
 1166 0098 3B7B     		ldrb	r3, [r7, #12]	@ zero_extendqisi2
 1167 009a 1B02     		lsls	r3, r3, #8
 1168 009c 9AB2     		uxth	r2, r3
 1169 009e 7B7B     		ldrb	r3, [r7, #13]	@ zero_extendqisi2
 1170 00a0 1343     		orrs	r3, r3, r2
 1171 00a2 9BB2     		uxth	r3, r3
 1172 00a4 9BB2     		uxth	r3, r3
 373:App/STM32F4-Discovery/spi.c **** 
 374:App/STM32F4-Discovery/spi.c **** }
 1173              		.loc 1 374 0
 1174 00a6 1846     		mov	r0, r3
 1175 00a8 1837     		adds	r7, r7, #24
 1176 00aa BD46     		mov	sp, r7
 1177              		@ sp needed
 1178 00ac 80BD     		pop	{r7, pc}
 1179              	.L34:
 1180 00ae 00BF     		.align	2
 1181              	.L33:
 1182 00b0 40640240 		.word	1073898560
 1183 00b4 58640240 		.word	1073898584
 1184 00b8 00000000 		.word	bufferTX
 1185 00bc 00000000 		.word	bufferRX
 1186 00c0 00000240 		.word	1073872896
 1187              		.cfi_endproc
 1188              	.LFE116:
 1190              		.section	.text.spi_dma_read,"ax",%progbits
 1191              		.align	2
 1192              		.global	spi_dma_read
 1193              		.thumb
 1194              		.thumb_func
 1196              	spi_dma_read:
 1197              	.LFB117:
 375:App/STM32F4-Discovery/spi.c **** void spi_dma_read(uint16_t address, uint16_t data_len)
 376:App/STM32F4-Discovery/spi.c **** {
 1198              		.loc 1 376 0
 1199              		.cfi_startproc
 1200              		@ args = 0, pretend = 0, frame = 24
 1201              		@ frame_needed = 1, uses_anonymous_args = 0
 1202 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1203              	.LCFI21:
 1204              		.cfi_def_cfa_offset 24
 1205              		.cfi_offset 4, -24
 1206              		.cfi_offset 5, -20
 1207              		.cfi_offset 6, -16
 1208              		.cfi_offset 7, -12
 1209              		.cfi_offset 8, -8
 1210              		.cfi_offset 14, -4
 1211 0004 86B0     		sub	sp, sp, #24
 1212              	.LCFI22:
 1213              		.cfi_def_cfa_offset 48
 1214 0006 00AF     		add	r7, sp, #0
 1215              	.LCFI23:
 1216              		.cfi_def_cfa_register 7
 1217 0008 F880     		strh	r0, [r7, #6]	@ movhi
 1218 000a B980     		strh	r1, [r7, #4]	@ movhi
 1219 000c 6946     		mov	r1, sp
 1220 000e 8846     		mov	r8, r1
 377:App/STM32F4-Discovery/spi.c **** 		
 378:App/STM32F4-Discovery/spi.c **** 		/*! spi_dma_read it has to be used with \n
 379:App/STM32F4-Discovery/spi.c **** 		 * memcpy from bufferRX right after it has recieve \n
 380:App/STM32F4-Discovery/spi.c **** 		 * data on SPI. */
 381:App/STM32F4-Discovery/spi.c **** 		
 382:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[data_len+4];
 1221              		.loc 1 382 0
 1222 0010 B988     		ldrh	r1, [r7, #4]
 1223 0012 0E1D     		adds	r6, r1, #4
 1224 0014 711E     		subs	r1, r6, #1
 1225 0016 3961     		str	r1, [r7, #16]
 1226 0018 3146     		mov	r1, r6
 1227 001a 0846     		mov	r0, r1
 1228 001c 4FF00001 		mov	r1, #0
 1229 0020 CD00     		lsls	r5, r1, #3
 1230 0022 45EA5075 		orr	r5, r5, r0, lsr #29
 1231 0026 C400     		lsls	r4, r0, #3
 1232 0028 3146     		mov	r1, r6
 1233 002a 0846     		mov	r0, r1
 1234 002c 4FF00001 		mov	r1, #0
 1235 0030 CB00     		lsls	r3, r1, #3
 1236 0032 43EA5073 		orr	r3, r3, r0, lsr #29
 1237 0036 C200     		lsls	r2, r0, #3
 1238 0038 3346     		mov	r3, r6
 1239 003a 0733     		adds	r3, r3, #7
 1240 003c DB08     		lsrs	r3, r3, #3
 1241 003e DB00     		lsls	r3, r3, #3
 1242 0040 ADEB030D 		sub	sp, sp, r3
 1243 0044 6B46     		mov	r3, sp
 1244 0046 0033     		adds	r3, r3, #0
 1245 0048 FB60     		str	r3, [r7, #12]
 383:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 1246              		.loc 1 383 0
 1247 004a FB88     		ldrh	r3, [r7, #6]
 1248 004c 1B0A     		lsrs	r3, r3, #8
 1249 004e 9BB2     		uxth	r3, r3
 1250 0050 DAB2     		uxtb	r2, r3
 1251 0052 FB68     		ldr	r3, [r7, #12]
 1252 0054 1A70     		strb	r2, [r3]
 384:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 1253              		.loc 1 384 0
 1254 0056 FB88     		ldrh	r3, [r7, #6]	@ movhi
 1255 0058 DAB2     		uxtb	r2, r3
 1256 005a FB68     		ldr	r3, [r7, #12]
 1257 005c 5A70     		strb	r2, [r3, #1]
 385:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x00 | (data_len & 0x7f00) >> 8 ));
 1258              		.loc 1 385 0
 1259 005e BB88     		ldrh	r3, [r7, #4]
 1260 0060 03F4FE43 		and	r3, r3, #32512
 1261 0064 1B12     		asrs	r3, r3, #8
 1262 0066 DAB2     		uxtb	r2, r3
 1263 0068 FB68     		ldr	r3, [r7, #12]
 1264 006a 9A70     		strb	r2, [r3, #2]
 386:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 1265              		.loc 1 386 0
 1266 006c BB88     		ldrh	r3, [r7, #4]	@ movhi
 1267 006e DAB2     		uxtb	r2, r3
 1268 0070 FB68     		ldr	r3, [r7, #12]
 1269 0072 DA70     		strb	r2, [r3, #3]
 387:App/STM32F4-Discovery/spi.c **** 
 388:App/STM32F4-Discovery/spi.c **** 		int i;
 389:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) buffer[i] = 0x0;
 1270              		.loc 1 389 0
 1271 0074 0423     		movs	r3, #4
 1272 0076 7B61     		str	r3, [r7, #20]
 1273 0078 07E0     		b	.L36
 1274              	.L37:
 1275              		.loc 1 389 0 is_stmt 0 discriminator 2
 1276 007a FA68     		ldr	r2, [r7, #12]
 1277 007c 7B69     		ldr	r3, [r7, #20]
 1278 007e 1344     		add	r3, r3, r2
 1279 0080 0022     		movs	r2, #0
 1280 0082 1A70     		strb	r2, [r3]
 1281 0084 7B69     		ldr	r3, [r7, #20]
 1282 0086 0133     		adds	r3, r3, #1
 1283 0088 7B61     		str	r3, [r7, #20]
 1284              	.L36:
 1285              		.loc 1 389 0 discriminator 1
 1286 008a BB88     		ldrh	r3, [r7, #4]
 1287 008c 1A1D     		adds	r2, r3, #4
 1288 008e 7B69     		ldr	r3, [r7, #20]
 1289 0090 9A42     		cmp	r2, r3
 1290 0092 F2DC     		bgt	.L37
 390:App/STM32F4-Discovery/spi.c **** 
 391:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_RX_DMA_STREAM, data_len+4);
 1291              		.loc 1 391 0 is_stmt 1
 1292 0094 BB88     		ldrh	r3, [r7, #4]	@ movhi
 1293 0096 0433     		adds	r3, r3, #4
 1294 0098 9BB2     		uxth	r3, r3
 1295 009a 1748     		ldr	r0, .L38
 1296 009c 1946     		mov	r1, r3
 1297 009e FFF7FEFF 		bl	DMA_SetCurrDataCounter
 392:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 4+data_len);
 1298              		.loc 1 392 0
 1299 00a2 BB88     		ldrh	r3, [r7, #4]	@ movhi
 1300 00a4 0433     		adds	r3, r3, #4
 1301 00a6 9BB2     		uxth	r3, r3
 1302 00a8 1448     		ldr	r0, .L38+4
 1303 00aa 1946     		mov	r1, r3
 1304 00ac FFF7FEFF 		bl	DMA_SetCurrDataCounter
 393:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 1305              		.loc 1 393 0
 1306 00b0 124B     		ldr	r3, .L38+4
 1307 00b2 FA68     		ldr	r2, [r7, #12]
 1308 00b4 DA60     		str	r2, [r3, #12]
 394:App/STM32F4-Discovery/spi.c **** 		SPIx_RX_DMA_STREAM->M0AR =(uint32_t)&bufferRX;	
 1309              		.loc 1 394 0
 1310 00b6 104B     		ldr	r3, .L38
 1311 00b8 114A     		ldr	r2, .L38+8
 1312 00ba DA60     		str	r2, [r3, #12]
 395:App/STM32F4-Discovery/spi.c **** 
 396:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1313              		.loc 1 396 0
 1314 00bc 114B     		ldr	r3, .L38+12
 1315 00be 114A     		ldr	r2, .L38+12
 1316 00c0 528B     		ldrh	r2, [r2, #26]	@ movhi
 1317 00c2 92B2     		uxth	r2, r2
 1318 00c4 42F01002 		orr	r2, r2, #16
 1319 00c8 92B2     		uxth	r2, r2
 1320 00ca 5A83     		strh	r2, [r3, #26]	@ movhi
 397:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1321              		.loc 1 397 0
 1322 00cc 0B48     		ldr	r0, .L38+4
 1323 00ce 0121     		movs	r1, #1
 1324 00d0 FFF7FEFF 		bl	DMA_Cmd
 398:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1325              		.loc 1 398 0
 1326 00d4 0848     		ldr	r0, .L38
 1327 00d6 0121     		movs	r1, #1
 1328 00d8 FFF7FEFF 		bl	DMA_Cmd
 399:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 400:App/STM32F4-Discovery/spi.c ****         	xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 1329              		.loc 1 400 0
 1330 00dc 0A4B     		ldr	r3, .L38+16
 1331 00de 1B68     		ldr	r3, [r3]
 1332 00e0 1846     		mov	r0, r3
 1333 00e2 0021     		movs	r1, #0
 1334 00e4 4FF0FF32 		mov	r2, #-1
 1335 00e8 0023     		movs	r3, #0
 1336 00ea FFF7FEFF 		bl	xQueueGenericReceive
 1337 00ee C546     		mov	sp, r8
 401:App/STM32F4-Discovery/spi.c **** 		//CSOFF(); // chip deselect		
 402:App/STM32F4-Discovery/spi.c **** 
 403:App/STM32F4-Discovery/spi.c **** }	
 1338              		.loc 1 403 0
 1339 00f0 1837     		adds	r7, r7, #24
 1340 00f2 BD46     		mov	sp, r7
 1341              		@ sp needed
 1342 00f4 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1343              	.L39:
 1344              		.align	2
 1345              	.L38:
 1346 00f8 40640240 		.word	1073898560
 1347 00fc 58640240 		.word	1073898584
 1348 0100 00000000 		.word	bufferRX
 1349 0104 00000240 		.word	1073872896
 1350 0108 00000000 		.word	xSemaphoreDMASPI
 1351              		.cfi_endproc
 1352              	.LFE117:
 1354              		.text
 1355              	.Letext0:
 1356              		.file 2 "/Users/maticknap/ARM/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/machine/_default_
 1357              		.file 3 "/Users/maticknap/ARM/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/stdint.h"
 1358              		.file 4 "App/STM32F4-Discovery/Libraries/CMSIS/ST/STM32F4xx/Include/stm32f4xx.h"
 1359              		.file 5 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_dma.h"
 1360              		.file 6 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_exti.h"
 1361              		.file 7 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_gpio.h"
 1362              		.file 8 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_spi.h"
 1363              		.file 9 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/misc.h"
 1364              		.file 10 "Source/portable/GCC/ARM_CM4F/portmacro.h"
 1365              		.file 11 "Source/include/task.h"
 1366              		.file 12 "Source/include/queue.h"
 1367              		.file 13 "Source/include/semphr.h"
 1368              		.file 14 "App/STM32F4-Discovery/Libraries/CMSIS/Include/core_cm4.h"
 1369              		.file 15 "App/STM32F4-Discovery/main.h"
 1370              		.file 16 "App/STM32F4-Discovery/spi.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 spi.c
                            *COM*:0000000000000004 xSemaphoreDMASPI
                            *COM*:0000000000000004 xSmphrUSART
                            *COM*:0000000000000004 xSemaphoreREADLEN
                            *COM*:0000000000000004 motorHeartBeatHandle
                            *COM*:0000000000000004 motorHBHandle
                            *COM*:0000000000000004 QSpd_handle
                            *COM*:0000000000000004 QTCP_handle
                            *COM*:0000000000000004 socket_0
                            *COM*:00000000000007d0 bufferTX
                            *COM*:00000000000007d0 bufferRX
                            *COM*:0000000000000004 bufferRXidx
                            *COM*:0000000000000004 bufferTXidx
                            *COM*:0000000000000004 dat_lengthRX
                            *COM*:0000000000000004 dat_lengthTX
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:34     .text.init_SPIx:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:39     .text.init_SPIx:0000000000000000 init_SPIx
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:463    .text.init_SPIx:0000000000000304 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:475    .text.DMA2_Stream2_IRQHandler:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:480    .text.DMA2_Stream2_IRQHandler:0000000000000000 DMA2_Stream2_IRQHandler
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:568    .text.DMA2_Stream2_IRQHandler:0000000000000080 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:579    .text.DMA2_Stream3_IRQHandler:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:584    .text.DMA2_Stream3_IRQHandler:0000000000000000 DMA2_Stream3_IRQHandler
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:672    .text.DMA2_Stream3_IRQHandler:0000000000000080 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:683    .text.spi_dma_send:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:688    .text.spi_dma_send:0000000000000000 spi_dma_send
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:839    .text.spi_dma_send:0000000000000100 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:847    .text.spi_dma_send2B:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:852    .text.spi_dma_send2B:0000000000000000 spi_dma_send2B
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:949    .text.spi_dma_send2B:0000000000000094 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:957    .text.spi_dma_sendByte:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:962    .text.spi_dma_sendByte:0000000000000000 spi_dma_sendByte
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1052   .text.spi_dma_sendByte:0000000000000088 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1060   .text.spi_dma_read2B:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1065   .text.spi_dma_read2B:0000000000000000 spi_dma_read2B
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1182   .text.spi_dma_read2B:00000000000000b0 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1191   .text.spi_dma_read:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1196   .text.spi_dma_read:0000000000000000 spi_dma_read
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//ccDy6cj4.s:1346   .text.spi_dma_read:00000000000000f8 $d
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
RCC_AHB1PeriphClockCmd
GPIO_Init
GPIO_PinAFConfig
RCC_APB2PeriphClockCmd
SPI_Init
SPI_Cmd
DMA_DeInit
DMA_GetCmdStatus
DMA_StructInit
DMA_Init
DMA_ITConfig
SPI_I2S_ClearFlag
NVIC_Init
SPI_I2S_DMACmd
SYSCFG_EXTILineConfig
EXTI_Init
DMA_GetITStatus
DMA_ClearITPendingBit
SPI_I2S_GetFlagStatus
DMA_Cmd
vPortEnterCritical
xQueueGenericSendFromISR
vPortExitCritical
DMA_SetCurrDataCounter
xQueueGenericReceive
