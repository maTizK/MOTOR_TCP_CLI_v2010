   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 3
   4              		.fpu fpv4-sp-d16
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 6
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.thumb
  15              		.file	"spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.comm	xSemaphoreDMASPI,4,4
  20              		.section	.bss.xHigherPriorityTaskWoken,"aw",%nobits
  21              		.align	2
  24              	xHigherPriorityTaskWoken:
  25 0000 00000000 		.space	4
  26              		.comm	xSmphrUSART,4,4
  27              		.comm	motorHeartBeatHandle,4,4
  28              		.comm	motorHBHandle,4,4
  29              		.comm	QSpd_handle,4,4
  30              		.comm	QStatus_handle,4,4
  31              		.comm	socket_0,4,4
  32              		.comm	bufferTX,2000,4
  33              		.comm	bufferRX,2000,4
  34              		.comm	bufferRXidx,4,4
  35              		.comm	bufferTXidx,4,4
  36              		.comm	dat_lengthRX,4,4
  37              		.comm	dat_lengthTX,4,4
  38              		.section	.text.init_SPIx,"ax",%progbits
  39              		.align	2
  40              		.global	init_SPIx
  41              		.thumb
  42              		.thumb_func
  44              	init_SPIx:
  45              	.LFB110:
  46              		.file 1 "App/STM32F4-Discovery/spi.c"
   1:App/STM32F4-Discovery/spi.c **** /*! \file spi.c */ 
   2:App/STM32F4-Discovery/spi.c **** 
   3:App/STM32F4-Discovery/spi.c **** #include "spi.h"
   4:App/STM32F4-Discovery/spi.c **** #define pdFalse 0
   5:App/STM32F4-Discovery/spi.c **** #define pdTrue 	1
   6:App/STM32F4-Discovery/spi.c **** 
   7:App/STM32F4-Discovery/spi.c **** /*============================================================================
   8:App/STM32F4-Discovery/spi.c ****  * 	func void init_SPIx(void)
   9:App/STM32F4-Discovery/spi.c ****  *===========================================================================*/ 
  10:App/STM32F4-Discovery/spi.c **** void init_SPIx(void){
  47              		.loc 1 10 0
  48              		.cfi_startproc
  49              		@ args = 0, pretend = 0, frame = 104
  50              		@ frame_needed = 1, uses_anonymous_args = 0
  51 0000 80B5     		push	{r7, lr}
  52              	.LCFI0:
  53              		.cfi_def_cfa_offset 8
  54              		.cfi_offset 7, -8
  55              		.cfi_offset 14, -4
  56 0002 9AB0     		sub	sp, sp, #104
  57              	.LCFI1:
  58              		.cfi_def_cfa_offset 112
  59 0004 00AF     		add	r7, sp, #0
  60              	.LCFI2:
  61              		.cfi_def_cfa_register 7
  11:App/STM32F4-Discovery/spi.c **** 	
  12:App/STM32F4-Discovery/spi.c **** 
  13:App/STM32F4-Discovery/spi.c **** 	/*! Initialize SPI pheriphial with DMA controller \n
  14:App/STM32F4-Discovery/spi.c **** 	 *  - SPI setup
  15:App/STM32F4-Discovery/spi.c **** 	 *  	+ MISO PA6
  16:App/STM32F4-Discovery/spi.c **** 	 *  	+ MOSI PA7
  17:App/STM32F4-Discovery/spi.c **** 	 *  	+ SCK PA5
  18:App/STM32F4-Discovery/spi.c **** 	 *	+ CS PA4
  19:App/STM32F4-Discovery/spi.c **** 	 *	+ HR pin PC5
  20:App/STM32F4-Discovery/spi.c **** 	 *\n
  21:App/STM32F4-Discovery/spi.c **** 	 * - WIZNET setup 
  22:App/STM32F4-Discovery/spi.c **** 	 *   	+ IT PC4 
  23:App/STM32F4-Discovery/spi.c **** 	 * */
  24:App/STM32F4-Discovery/spi.c **** 	GPIO_InitTypeDef GPIO_InitStruct;
  25:App/STM32F4-Discovery/spi.c **** 	SPI_InitTypeDef SPI_InitStruct;
  26:App/STM32F4-Discovery/spi.c **** 	DMA_InitTypeDef DMA_InitStruct;
  27:App/STM32F4-Discovery/spi.c **** 	NVIC_InitTypeDef NVIC_InitStruct;
  28:App/STM32F4-Discovery/spi.c **** 
  29:App/STM32F4-Discovery/spi.c **** 	
  30:App/STM32F4-Discovery/spi.c **** 	
  31:App/STM32F4-Discovery/spi.c **** 	// enable clock for used IO pins
  32:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_MOSI_GPIO_CLK, ENABLE);
  62              		.loc 1 32 0
  63 0006 0120     		movs	r0, #1
  64 0008 0121     		movs	r1, #1
  65 000a FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  33:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_MISO_GPIO_CLK, ENABLE);
  66              		.loc 1 33 0
  67 000e 0120     		movs	r0, #1
  68 0010 0121     		movs	r1, #1
  69 0012 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  34:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(SPIx_SCK_GPIO_CLK, ENABLE);
  70              		.loc 1 34 0
  71 0016 0120     		movs	r0, #1
  72 0018 0121     		movs	r1, #1
  73 001a FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  35:App/STM32F4-Discovery/spi.c **** 	
  36:App/STM32F4-Discovery/spi.c **** 	/* configure pins used by SPI1
  37:App/STM32F4-Discovery/spi.c **** 	 * PA5 = SCK
  38:App/STM32F4-Discovery/spi.c **** 	 * PA6 = MISO
  39:App/STM32F4-Discovery/spi.c **** 	 * PA7 = MOSI
  40:App/STM32F4-Discovery/spi.c **** 	 */
  41:App/STM32F4-Discovery/spi.c **** 	// MOSI PA7
  42:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MOSI_PIN ;
  74              		.loc 1 42 0
  75 001e 8023     		movs	r3, #128
  76 0020 3B66     		str	r3, [r7, #96]
  43:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  77              		.loc 1 43 0
  78 0022 0223     		movs	r3, #2
  79 0024 87F86430 		strb	r3, [r7, #100]
  44:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
  80              		.loc 1 44 0
  81 0028 0023     		movs	r3, #0
  82 002a 87F86630 		strb	r3, [r7, #102]
  45:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
  83              		.loc 1 45 0
  84 002e 0323     		movs	r3, #3
  85 0030 87F86530 		strb	r3, [r7, #101]
  46:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
  86              		.loc 1 46 0
  87 0034 0223     		movs	r3, #2
  88 0036 87F86730 		strb	r3, [r7, #103]
  47:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_MOSI_GPIO_PORT, &GPIO_InitStruct);
  89              		.loc 1 47 0
  90 003a 07F16003 		add	r3, r7, #96
  91 003e B148     		ldr	r0, .L4
  92 0040 1946     		mov	r1, r3
  93 0042 FFF7FEFF 		bl	GPIO_Init
  48:App/STM32F4-Discovery/spi.c **** 	// SCK PA5
  49:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_SCK_PIN;
  94              		.loc 1 49 0
  95 0046 2023     		movs	r3, #32
  96 0048 3B66     		str	r3, [r7, #96]
  50:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
  97              		.loc 1 50 0
  98 004a 0223     		movs	r3, #2
  99 004c 87F86430 		strb	r3, [r7, #100]
  51:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 100              		.loc 1 51 0
 101 0050 0023     		movs	r3, #0
 102 0052 87F86630 		strb	r3, [r7, #102]
  52:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 103              		.loc 1 52 0
 104 0056 0323     		movs	r3, #3
 105 0058 87F86530 		strb	r3, [r7, #101]
  53:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_DOWN;
 106              		.loc 1 53 0
 107 005c 0223     		movs	r3, #2
 108 005e 87F86730 		strb	r3, [r7, #103]
  54:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_SCK_GPIO_PORT, &GPIO_InitStruct);
 109              		.loc 1 54 0
 110 0062 07F16003 		add	r3, r7, #96
 111 0066 A748     		ldr	r0, .L4
 112 0068 1946     		mov	r1, r3
 113 006a FFF7FEFF 		bl	GPIO_Init
  55:App/STM32F4-Discovery/spi.c **** 	// MISO PA6
  56:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_MISO_PIN;
 114              		.loc 1 56 0
 115 006e 4023     		movs	r3, #64
 116 0070 3B66     		str	r3, [r7, #96]
  57:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF;
 117              		.loc 1 57 0
 118 0072 0223     		movs	r3, #2
 119 0074 87F86430 		strb	r3, [r7, #100]
  58:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_OD;
 120              		.loc 1 58 0
 121 0078 0123     		movs	r3, #1
 122 007a 87F86630 		strb	r3, [r7, #102]
  59:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 123              		.loc 1 59 0
 124 007e 0323     		movs	r3, #3
 125 0080 87F86530 		strb	r3, [r7, #101]
  60:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
 126              		.loc 1 60 0
 127 0084 0023     		movs	r3, #0
 128 0086 87F86730 		strb	r3, [r7, #103]
  61:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_MISO_GPIO_PORT, &GPIO_InitStruct);
 129              		.loc 1 61 0
 130 008a 07F16003 		add	r3, r7, #96
 131 008e 9D48     		ldr	r0, .L4
 132 0090 1946     		mov	r1, r3
 133 0092 FFF7FEFF 		bl	GPIO_Init
  62:App/STM32F4-Discovery/spi.c **** 	
  63:App/STM32F4-Discovery/spi.c **** 	// connect SPI1 pins to SPI alternate function
  64:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_MISO_GPIO_PORT, SPIx_MISO_SOURCE, SPIx_MISO_AF);
 134              		.loc 1 64 0
 135 0096 9B48     		ldr	r0, .L4
 136 0098 0621     		movs	r1, #6
 137 009a 0522     		movs	r2, #5
 138 009c FFF7FEFF 		bl	GPIO_PinAFConfig
  65:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_MOSI_GPIO_PORT, SPIx_MOSI_SOURCE, SPIx_MOSI_AF);
 139              		.loc 1 65 0
 140 00a0 9848     		ldr	r0, .L4
 141 00a2 0721     		movs	r1, #7
 142 00a4 0522     		movs	r2, #5
 143 00a6 FFF7FEFF 		bl	GPIO_PinAFConfig
  66:App/STM32F4-Discovery/spi.c **** 	GPIO_PinAFConfig(SPIx_SCK_GPIO_PORT,  SPIx_SCK_SOURCE,  SPIx_SCK_AF);
 144              		.loc 1 66 0
 145 00aa 9648     		ldr	r0, .L4
 146 00ac 0521     		movs	r1, #5
 147 00ae 0522     		movs	r2, #5
 148 00b0 FFF7FEFF 		bl	GPIO_PinAFConfig
  67:App/STM32F4-Discovery/spi.c **** 
  68:App/STM32F4-Discovery/spi.c **** 
  69:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(WIZ_HR_GPIO_CLK, ENABLE);
 149              		.loc 1 69 0
 150 00b4 0420     		movs	r0, #4
 151 00b6 0121     		movs	r1, #1
 152 00b8 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  70:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd(WIZ_IT_GPIO_CLK, ENABLE);
 153              		.loc 1 70 0
 154 00bc 0420     		movs	r0, #4
 155 00be 0121     		movs	r1, #1
 156 00c0 FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
  71:App/STM32F4-Discovery/spi.c **** 	
  72:App/STM32F4-Discovery/spi.c **** 		
  73:App/STM32F4-Discovery/spi.c **** 	/* Configure the chip select pin
  74:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA4 */
  75:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = SPIx_CS_PIN;
 157              		.loc 1 75 0
 158 00c4 1023     		movs	r3, #16
 159 00c6 3B66     		str	r3, [r7, #96]
  76:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 160              		.loc 1 76 0
 161 00c8 0123     		movs	r3, #1
 162 00ca 87F86430 		strb	r3, [r7, #100]
  77:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 163              		.loc 1 77 0
 164 00ce 0023     		movs	r3, #0
 165 00d0 87F86630 		strb	r3, [r7, #102]
  78:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 166              		.loc 1 78 0
 167 00d4 0323     		movs	r3, #3
 168 00d6 87F86530 		strb	r3, [r7, #101]
  79:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 169              		.loc 1 79 0
 170 00da 0123     		movs	r3, #1
 171 00dc 87F86730 		strb	r3, [r7, #103]
  80:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(SPIx_CS_GPIO_PORT, &GPIO_InitStruct);
 172              		.loc 1 80 0
 173 00e0 07F16003 		add	r3, r7, #96
 174 00e4 8748     		ldr	r0, .L4
 175 00e6 1946     		mov	r1, r3
 176 00e8 FFF7FEFF 		bl	GPIO_Init
  81:App/STM32F4-Discovery/spi.c **** 	
  82:App/STM32F4-Discovery/spi.c **** 	CSOFF(); // set PA4 high
 177              		.loc 1 82 0
 178 00ec 854B     		ldr	r3, .L4
 179 00ee 854A     		ldr	r2, .L4
 180 00f0 128B     		ldrh	r2, [r2, #24]	@ movhi
 181 00f2 92B2     		uxth	r2, r2
 182 00f4 42F01002 		orr	r2, r2, #16
 183 00f8 92B2     		uxth	r2, r2
 184 00fa 1A83     		strh	r2, [r3, #24]	@ movhi
  83:App/STM32F4-Discovery/spi.c **** 
  84:App/STM32F4-Discovery/spi.c **** 	/* Configure the hard reset pin
  85:App/STM32F4-Discovery/spi.c **** 	   in this case we will use PA3 */
  86:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = WIZ_HR_PIN;
 185              		.loc 1 86 0
 186 00fc 2023     		movs	r3, #32
 187 00fe 3B66     		str	r3, [r7, #96]
  87:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_OUT;
 188              		.loc 1 87 0
 189 0100 0123     		movs	r3, #1
 190 0102 87F86430 		strb	r3, [r7, #100]
  88:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 191              		.loc 1 88 0
 192 0106 0023     		movs	r3, #0
 193 0108 87F86630 		strb	r3, [r7, #102]
  89:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 194              		.loc 1 89 0
 195 010c 0323     		movs	r3, #3
 196 010e 87F86530 		strb	r3, [r7, #101]
  90:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_UP;
 197              		.loc 1 90 0
 198 0112 0123     		movs	r3, #1
 199 0114 87F86730 		strb	r3, [r7, #103]
  91:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(WIZ_HR_GPIO_PORT, &GPIO_InitStruct);
 200              		.loc 1 91 0
 201 0118 07F16003 		add	r3, r7, #96
 202 011c 7A48     		ldr	r0, .L4+4
 203 011e 1946     		mov	r1, r3
 204 0120 FFF7FEFF 		bl	GPIO_Init
  92:App/STM32F4-Discovery/spi.c **** 	
  93:App/STM32F4-Discovery/spi.c **** 	RESET_LOW(); // set PA3 high
 205              		.loc 1 93 0
 206 0124 784B     		ldr	r3, .L4+4
 207 0126 784A     		ldr	r2, .L4+4
 208 0128 128B     		ldrh	r2, [r2, #24]	@ movhi
 209 012a 92B2     		uxth	r2, r2
 210 012c 42F02002 		orr	r2, r2, #32
 211 0130 92B2     		uxth	r2, r2
 212 0132 1A83     		strh	r2, [r3, #24]	@ movhi
  94:App/STM32F4-Discovery/spi.c **** 
  95:App/STM32F4-Discovery/spi.c **** 	// enable peripheral clock
  96:App/STM32F4-Discovery/spi.c **** 	RCC_APB2PeriphClockCmd(SPIx_CLK, ENABLE);
 213              		.loc 1 96 0
 214 0134 4FF48050 		mov	r0, #4096
 215 0138 0121     		movs	r1, #1
 216 013a FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
  97:App/STM32F4-Discovery/spi.c **** 	
  98:App/STM32F4-Discovery/spi.c **** 	/* configure SPI1 in Mode 0 
  99:App/STM32F4-Discovery/spi.c **** 	 * CPOL = 0 --> clock is low when idle
 100:App/STM32F4-Discovery/spi.c **** 	 * CPHA = 0 --> data is sampled at the first edge
 101:App/STM32F4-Discovery/spi.c **** 	 */
 102:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Direction = SPI_Direction_2Lines_FullDuplex; // set to full duplex mode, sepera
 217              		.loc 1 102 0
 218 013e 0023     		movs	r3, #0
 219 0140 A7F84C30 		strh	r3, [r7, #76]	@ movhi
 103:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_Mode = SPI_Mode_Master;     // transmit in master mode, NSS pin has to be alway
 220              		.loc 1 103 0
 221 0144 4FF48273 		mov	r3, #260
 222 0148 A7F84E30 		strh	r3, [r7, #78]	@ movhi
 104:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_DataSize = SPI_DataSize_8b; // one packet of data is 8 bits wide
 223              		.loc 1 104 0
 224 014c 0023     		movs	r3, #0
 225 014e A7F85030 		strh	r3, [r7, #80]	@ movhi
 105:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPOL = SPI_CPOL_Low;        // clock is low when idle
 226              		.loc 1 105 0
 227 0152 0023     		movs	r3, #0
 228 0154 A7F85230 		strh	r3, [r7, #82]	@ movhi
 106:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_CPHA = SPI_CPHA_1Edge;      // data sampled at second edge
 229              		.loc 1 106 0
 230 0158 0023     		movs	r3, #0
 231 015a A7F85430 		strh	r3, [r7, #84]	@ movhi
 107:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_NSS = SPI_NSS_Soft | SPI_NSSInternalSoft_Set; // set the NSS management to inte
 232              		.loc 1 107 0
 233 015e 4FF44073 		mov	r3, #768
 234 0162 A7F85630 		strh	r3, [r7, #86]	@ movhi
 108:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_BaudRatePrescaler = SPI_BaudRatePrescaler_4; // SPI frequency is APB2 frequency
 235              		.loc 1 108 0
 236 0166 0823     		movs	r3, #8
 237 0168 A7F85830 		strh	r3, [r7, #88]	@ movhi
 109:App/STM32F4-Discovery/spi.c **** 	SPI_InitStruct.SPI_FirstBit = SPI_FirstBit_MSB;// data is transmitted MSB first
 238              		.loc 1 109 0
 239 016c 0023     		movs	r3, #0
 240 016e A7F85A30 		strh	r3, [r7, #90]	@ movhi
 110:App/STM32F4-Discovery/spi.c **** 	SPI_Init(SPIx, &SPI_InitStruct); 
 241              		.loc 1 110 0
 242 0172 07F14C03 		add	r3, r7, #76
 243 0176 6548     		ldr	r0, .L4+8
 244 0178 1946     		mov	r1, r3
 245 017a FFF7FEFF 		bl	SPI_Init
 111:App/STM32F4-Discovery/spi.c **** 	
 112:App/STM32F4-Discovery/spi.c **** 	SPI_Cmd(SPIx, ENABLE);			
 246              		.loc 1 112 0
 247 017e 6348     		ldr	r0, .L4+8
 248 0180 0121     		movs	r1, #1
 249 0182 FFF7FEFF 		bl	SPI_Cmd
 113:App/STM32F4-Discovery/spi.c **** 	
 114:App/STM32F4-Discovery/spi.c **** 
 115:App/STM32F4-Discovery/spi.c **** 	/* setup DMA */
 116:App/STM32F4-Discovery/spi.c **** 
 117:App/STM32F4-Discovery/spi.c **** 	// enable clock 
 118:App/STM32F4-Discovery/spi.c **** 	RCC_AHB1PeriphClockCmd (SPIx_DMA_CLK, ENABLE); 
 250              		.loc 1 118 0
 251 0186 4FF48000 		mov	r0, #4194304
 252 018a 0121     		movs	r1, #1
 253 018c FFF7FEFF 		bl	RCC_AHB1PeriphClockCmd
 119:App/STM32F4-Discovery/spi.c **** 	
 120:App/STM32F4-Discovery/spi.c **** 	// start with blank DMA configuration
 121:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_TX_DMA_STREAM);
 254              		.loc 1 121 0
 255 0190 5F48     		ldr	r0, .L4+12
 256 0192 FFF7FEFF 		bl	DMA_DeInit
 122:App/STM32F4-Discovery/spi.c **** 	DMA_DeInit (SPIx_RX_DMA_STREAM);
 257              		.loc 1 122 0
 258 0196 5F48     		ldr	r0, .L4+16
 259 0198 FFF7FEFF 		bl	DMA_DeInit
 123:App/STM32F4-Discovery/spi.c **** 
 124:App/STM32F4-Discovery/spi.c **** 	// check if DMA stream is disabled before enabling 
 125:App/STM32F4-Discovery/spi.c **** 	// this is useful when stream is enabled and disabled multiple times. 
 126:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_TX_DMA_STREAM) != DISABLE);
 260              		.loc 1 126 0
 261 019c 00BF     		nop
 262              	.L2:
 263              		.loc 1 126 0 is_stmt 0 discriminator 1
 264 019e 5C48     		ldr	r0, .L4+12
 265 01a0 FFF7FEFF 		bl	DMA_GetCmdStatus
 266 01a4 0346     		mov	r3, r0
 267 01a6 002B     		cmp	r3, #0
 268 01a8 F9D1     		bne	.L2
 127:App/STM32F4-Discovery/spi.c **** 	while (DMA_GetCmdStatus (SPIx_RX_DMA_STREAM) != DISABLE);
 269              		.loc 1 127 0 is_stmt 1
 270 01aa 00BF     		nop
 271              	.L3:
 272              		.loc 1 127 0 is_stmt 0 discriminator 1
 273 01ac 5948     		ldr	r0, .L4+16
 274 01ae FFF7FEFF 		bl	DMA_GetCmdStatus
 275 01b2 0346     		mov	r3, r0
 276 01b4 002B     		cmp	r3, #0
 277 01b6 F9D1     		bne	.L3
 128:App/STM32F4-Discovery/spi.c **** 	
 129:App/STM32F4-Discovery/spi.c **** 	
 130:App/STM32F4-Discovery/spi.c **** 	DMA_StructInit(&DMA_InitStruct);
 278              		.loc 1 130 0 is_stmt 1
 279 01b8 07F11003 		add	r3, r7, #16
 280 01bc 1846     		mov	r0, r3
 281 01be FFF7FEFF 		bl	DMA_StructInit
 131:App/STM32F4-Discovery/spi.c ****   	//Configure DMA Initialization Structure
 132:App/STM32F4-Discovery/spi.c **** 	//DMA_InitStruct.DMA_FIFOMode = DMA_FIFOMode_Disable ;
 133:App/STM32F4-Discovery/spi.c ****  	//DMA_InitStruct.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull ;
 134:App/STM32F4-Discovery/spi.c ****   	//DMA_InitStruct.DMA_MemoryBurst = DMA_MemoryBurst_Single ;
 135:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;
 282              		.loc 1 135 0
 283 01c2 0023     		movs	r3, #0
 284 01c4 3B63     		str	r3, [r7, #48]
 136:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_MemoryInc = DMA_MemoryInc_Enable;
 285              		.loc 1 136 0
 286 01c6 4FF48063 		mov	r3, #1024
 287 01ca BB62     		str	r3, [r7, #40]
 137:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Mode = DMA_Mode_Normal;
 288              		.loc 1 137 0
 289 01cc 0023     		movs	r3, #0
 290 01ce 7B63     		str	r3, [r7, #52]
 138:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBaseAddr =(uint32_t) (&(SPIx->DR)) ;
 291              		.loc 1 138 0
 292 01d0 514B     		ldr	r3, .L4+20
 293 01d2 7B61     		str	r3, [r7, #20]
 139:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
 294              		.loc 1 139 0
 295 01d4 0023     		movs	r3, #0
 296 01d6 BB64     		str	r3, [r7, #72]
 140:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;
 297              		.loc 1 140 0
 298 01d8 0023     		movs	r3, #0
 299 01da FB62     		str	r3, [r7, #44]
 141:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
 300              		.loc 1 141 0
 301 01dc 0023     		movs	r3, #0
 302 01de 7B62     		str	r3, [r7, #36]
 142:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Priority = DMA_Priority_High;
 303              		.loc 1 142 0
 304 01e0 4FF40033 		mov	r3, #131072
 305 01e4 BB63     		str	r3, [r7, #56]
 143:App/STM32F4-Discovery/spi.c ****   	// Configure TX DMA 
 144:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Channel = SPIx_TX_DMA_CHANNEL ;
 306              		.loc 1 144 0
 307 01e6 4FF0C063 		mov	r3, #100663296
 308 01ea 3B61     		str	r3, [r7, #16]
 145:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_DIR = DMA_DIR_MemoryToPeripheral ;
 309              		.loc 1 145 0
 310 01ec 4023     		movs	r3, #64
 311 01ee FB61     		str	r3, [r7, #28]
 146:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t) &bufferTX ;
 312              		.loc 1 146 0
 313 01f0 4A4B     		ldr	r3, .L4+24
 314 01f2 BB61     		str	r3, [r7, #24]
 147:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 315              		.loc 1 147 0
 316 01f4 4FF4FA63 		mov	r3, #2000
 317 01f8 3B62     		str	r3, [r7, #32]
 148:App/STM32F4-Discovery/spi.c ****   	DMA_Init(SPIx_TX_DMA_STREAM, &DMA_InitStruct);
 318              		.loc 1 148 0
 319 01fa 07F11003 		add	r3, r7, #16
 320 01fe 4448     		ldr	r0, .L4+12
 321 0200 1946     		mov	r1, r3
 322 0202 FFF7FEFF 		bl	DMA_Init
 149:App/STM32F4-Discovery/spi.c **** 	// Configure RX DMA 
 150:App/STM32F4-Discovery/spi.c ****   	DMA_InitStruct.DMA_Channel = SPIx_RX_DMA_CHANNEL ;
 323              		.loc 1 150 0
 324 0206 4FF0C063 		mov	r3, #100663296
 325 020a 3B61     		str	r3, [r7, #16]
 151:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_DIR = DMA_DIR_PeripheralToMemory ;
 326              		.loc 1 151 0
 327 020c 0023     		movs	r3, #0
 328 020e FB61     		str	r3, [r7, #28]
 152:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_Memory0BaseAddr = (uint32_t)&bufferRX; 
 329              		.loc 1 152 0
 330 0210 434B     		ldr	r3, .L4+28
 331 0212 BB61     		str	r3, [r7, #24]
 153:App/STM32F4-Discovery/spi.c **** 	DMA_InitStruct.DMA_BufferSize = MAX_BUFFER_LENGTH;
 332              		.loc 1 153 0
 333 0214 4FF4FA63 		mov	r3, #2000
 334 0218 3B62     		str	r3, [r7, #32]
 154:App/STM32F4-Discovery/spi.c **** 	DMA_Init(SPIx_RX_DMA_STREAM, &DMA_InitStruct);	
 335              		.loc 1 154 0
 336 021a 07F11003 		add	r3, r7, #16
 337 021e 3D48     		ldr	r0, .L4+16
 338 0220 1946     		mov	r1, r3
 339 0222 FFF7FEFF 		bl	DMA_Init
 155:App/STM32F4-Discovery/spi.c **** 	
 156:App/STM32F4-Discovery/spi.c **** 	DMA_ITConfig(SPIx_TX_DMA_STREAM, DMA_IT_TC, ENABLE); 
 340              		.loc 1 156 0
 341 0226 3A48     		ldr	r0, .L4+12
 342 0228 1021     		movs	r1, #16
 343 022a 0122     		movs	r2, #1
 344 022c FFF7FEFF 		bl	DMA_ITConfig
 157:App/STM32F4-Discovery/spi.c **** 	DMA_ITConfig(SPIx_RX_DMA_STREAM, DMA_IT_TC, ENABLE); 
 345              		.loc 1 157 0
 346 0230 3848     		ldr	r0, .L4+16
 347 0232 1021     		movs	r1, #16
 348 0234 0122     		movs	r2, #1
 349 0236 FFF7FEFF 		bl	DMA_ITConfig
 158:App/STM32F4-Discovery/spi.c ****   
 159:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_TXE);
 350              		.loc 1 159 0
 351 023a 3448     		ldr	r0, .L4+8
 352 023c 0221     		movs	r1, #2
 353 023e FFF7FEFF 		bl	SPI_I2S_ClearFlag
 160:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_ClearFlag(SPIx, SPI_I2S_FLAG_RXNE);
 354              		.loc 1 160 0
 355 0242 3248     		ldr	r0, .L4+8
 356 0244 0121     		movs	r1, #1
 357 0246 FFF7FEFF 		bl	SPI_I2S_ClearFlag
 161:App/STM32F4-Discovery/spi.c ****   	
 162:App/STM32F4-Discovery/spi.c **** 	// enable the interrupt in the NVIC
 163:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannel = SPIx_TX_DMA_IRQn;
 358              		.loc 1 163 0
 359 024a 3B23     		movs	r3, #59
 360 024c 3B73     		strb	r3, [r7, #12]
 164:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY
 361              		.loc 1 164 0
 362 024e 0623     		movs	r3, #6
 363 0250 7B73     		strb	r3, [r7, #13]
 165:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0x1;
 364              		.loc 1 165 0
 365 0252 0123     		movs	r3, #1
 366 0254 BB73     		strb	r3, [r7, #14]
 166:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 367              		.loc 1 166 0
 368 0256 0123     		movs	r3, #1
 369 0258 FB73     		strb	r3, [r7, #15]
 167:App/STM32F4-Discovery/spi.c ****   	NVIC_Init (&NVIC_InitStruct);
 370              		.loc 1 167 0
 371 025a 07F10C03 		add	r3, r7, #12
 372 025e 1846     		mov	r0, r3
 373 0260 FFF7FEFF 		bl	NVIC_Init
 168:App/STM32F4-Discovery/spi.c **** 	// enable the interrupt in the NVIC
 169:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannel = SPIx_RX_DMA_IRQn;
 374              		.loc 1 169 0
 375 0264 3A23     		movs	r3, #58
 376 0266 3B73     		strb	r3, [r7, #12]
 170:App/STM32F4-Discovery/spi.c ****    	NVIC_InitStruct.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORIT
 377              		.loc 1 170 0
 378 0268 0623     		movs	r3, #6
 379 026a 7B73     		strb	r3, [r7, #13]
 171:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct.NVIC_IRQChannelSubPriority = 0x2;
 380              		.loc 1 171 0
 381 026c 0223     		movs	r3, #2
 382 026e BB73     		strb	r3, [r7, #14]
 172:App/STM32F4-Discovery/spi.c ****   	NVIC_InitStruct.NVIC_IRQChannelCmd = ENABLE;
 383              		.loc 1 172 0
 384 0270 0123     		movs	r3, #1
 385 0272 FB73     		strb	r3, [r7, #15]
 173:App/STM32F4-Discovery/spi.c ****   	NVIC_Init (&NVIC_InitStruct);
 386              		.loc 1 173 0
 387 0274 07F10C03 		add	r3, r7, #12
 388 0278 1846     		mov	r0, r3
 389 027a FFF7FEFF 		bl	NVIC_Init
 174:App/STM32F4-Discovery/spi.c ****   	// Enable dma tx and rx request
 175:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Tx, ENABLE);	
 390              		.loc 1 175 0
 391 027e 2348     		ldr	r0, .L4+8
 392 0280 0221     		movs	r1, #2
 393 0282 0122     		movs	r2, #1
 394 0284 FFF7FEFF 		bl	SPI_I2S_DMACmd
 176:App/STM32F4-Discovery/spi.c **** 	SPI_I2S_DMACmd (SPIx, SPI_I2S_DMAReq_Rx, ENABLE);	
 395              		.loc 1 176 0
 396 0288 2048     		ldr	r0, .L4+8
 397 028a 0121     		movs	r1, #1
 398 028c 0122     		movs	r2, #1
 399 028e FFF7FEFF 		bl	SPI_I2S_DMACmd
 177:App/STM32F4-Discovery/spi.c **** 	
 178:App/STM32F4-Discovery/spi.c **** 
 179:App/STM32F4-Discovery/spi.c **** 	/* Configure interrupt pin */
 180:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Pin = WIZ_IT_PIN;
 400              		.loc 1 180 0
 401 0292 1023     		movs	r3, #16
 402 0294 3B66     		str	r3, [r7, #96]
 181:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_IN;
 403              		.loc 1 181 0
 404 0296 0023     		movs	r3, #0
 405 0298 87F86430 		strb	r3, [r7, #100]
 182:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_OType = GPIO_OType_PP;
 406              		.loc 1 182 0
 407 029c 0023     		movs	r3, #0
 408 029e 87F86630 		strb	r3, [r7, #102]
 183:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_PuPd = GPIO_PuPd_NOPULL;
 409              		.loc 1 183 0
 410 02a2 0023     		movs	r3, #0
 411 02a4 87F86730 		strb	r3, [r7, #103]
 184:App/STM32F4-Discovery/spi.c **** 	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_100MHz;
 412              		.loc 1 184 0
 413 02a8 0323     		movs	r3, #3
 414 02aa 87F86530 		strb	r3, [r7, #101]
 185:App/STM32F4-Discovery/spi.c **** 	GPIO_Init(WIZ_IT_GPIO_PORT, &GPIO_InitStruct);	
 415              		.loc 1 185 0
 416 02ae 07F16003 		add	r3, r7, #96
 417 02b2 1548     		ldr	r0, .L4+4
 418 02b4 1946     		mov	r1, r3
 419 02b6 FFF7FEFF 		bl	GPIO_Init
 186:App/STM32F4-Discovery/spi.c **** 	
 187:App/STM32F4-Discovery/spi.c **** 	EXTI_InitTypeDef EXTI_InitStruct;
 188:App/STM32F4-Discovery/spi.c **** 	NVIC_InitTypeDef NVIC_InitStruct1;
 189:App/STM32F4-Discovery/spi.c **** 	/* Connect EXTI Line to appropriate GPIO Pin */ 
 190:App/STM32F4-Discovery/spi.c **** 	
 191:App/STM32F4-Discovery/spi.c **** 	RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);
 420              		.loc 1 191 0
 421 02ba 4FF48040 		mov	r0, #16384
 422 02be 0121     		movs	r1, #1
 423 02c0 FFF7FEFF 		bl	RCC_APB2PeriphClockCmd
 192:App/STM32F4-Discovery/spi.c **** 
 193:App/STM32F4-Discovery/spi.c **** 	SYSCFG_EXTILineConfig(WIZ_IT_EXTI_PORT_SOURCE, WIZ_IT_EXTI_PIN_SOURCE);
 424              		.loc 1 193 0
 425 02c4 0220     		movs	r0, #2
 426 02c6 0421     		movs	r1, #4
 427 02c8 FFF7FEFF 		bl	SYSCFG_EXTILineConfig
 194:App/STM32F4-Discovery/spi.c **** 	
 195:App/STM32F4-Discovery/spi.c **** 	/* Configure EXTI Line */
 196:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Line = WIZ_IT_EXTI_LINE;
 428              		.loc 1 196 0
 429 02cc 1023     		movs	r3, #16
 430 02ce 7B60     		str	r3, [r7, #4]
 197:App/STM32F4-Discovery/spi.c ****  	EXTI_InitStruct.EXTI_Mode = EXTI_Mode_Interrupt;
 431              		.loc 1 197 0
 432 02d0 0023     		movs	r3, #0
 433 02d2 3B72     		strb	r3, [r7, #8]
 198:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_Trigger = EXTI_Trigger_Falling;
 434              		.loc 1 198 0
 435 02d4 0C23     		movs	r3, #12
 436 02d6 7B72     		strb	r3, [r7, #9]
 199:App/STM32F4-Discovery/spi.c **** 	EXTI_InitStruct.EXTI_LineCmd = ENABLE;
 437              		.loc 1 199 0
 438 02d8 0123     		movs	r3, #1
 439 02da BB72     		strb	r3, [r7, #10]
 200:App/STM32F4-Discovery/spi.c **** 	EXTI_Init(&EXTI_InitStruct);
 440              		.loc 1 200 0
 441 02dc 3B1D     		adds	r3, r7, #4
 442 02de 1846     		mov	r0, r3
 443 02e0 FFF7FEFF 		bl	EXTI_Init
 201:App/STM32F4-Discovery/spi.c ****  	
 202:App/STM32F4-Discovery/spi.c ****  	/* Enable and set EXTI Line Interrupt */
 203:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct1.NVIC_IRQChannel = WIZ_IT_EXTI_IRQn;
 444              		.loc 1 203 0
 445 02e4 0A23     		movs	r3, #10
 446 02e6 3B70     		strb	r3, [r7]
 204:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct1.NVIC_IRQChannelPreemptionPriority = configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY
 447              		.loc 1 204 0
 448 02e8 0A23     		movs	r3, #10
 449 02ea 7B70     		strb	r3, [r7, #1]
 205:App/STM32F4-Discovery/spi.c **** 	NVIC_InitStruct1.NVIC_IRQChannelSubPriority = 0x3;
 450              		.loc 1 205 0
 451 02ec 0323     		movs	r3, #3
 452 02ee BB70     		strb	r3, [r7, #2]
 206:App/STM32F4-Discovery/spi.c ****  	NVIC_InitStruct1.NVIC_IRQChannelCmd = ENABLE;
 453              		.loc 1 206 0
 454 02f0 0123     		movs	r3, #1
 455 02f2 FB70     		strb	r3, [r7, #3]
 207:App/STM32F4-Discovery/spi.c **** 	NVIC_Init(&NVIC_InitStruct1);
 456              		.loc 1 207 0
 457 02f4 3B46     		mov	r3, r7
 458 02f6 1846     		mov	r0, r3
 459 02f8 FFF7FEFF 		bl	NVIC_Init
 208:App/STM32F4-Discovery/spi.c **** 
 209:App/STM32F4-Discovery/spi.c **** 
 210:App/STM32F4-Discovery/spi.c **** 	
 211:App/STM32F4-Discovery/spi.c **** }
 460              		.loc 1 211 0
 461 02fc 6837     		adds	r7, r7, #104
 462 02fe BD46     		mov	sp, r7
 463              		@ sp needed
 464 0300 80BD     		pop	{r7, pc}
 465              	.L5:
 466 0302 00BF     		.align	2
 467              	.L4:
 468 0304 00000240 		.word	1073872896
 469 0308 00080240 		.word	1073874944
 470 030c 00300140 		.word	1073819648
 471 0310 58640240 		.word	1073898584
 472 0314 40640240 		.word	1073898560
 473 0318 0C300140 		.word	1073819660
 474 031c 00000000 		.word	bufferTX
 475 0320 00000000 		.word	bufferRX
 476              		.cfi_endproc
 477              	.LFE110:
 479              		.section	.text.DMA2_Stream2_IRQHandler,"ax",%progbits
 480              		.align	2
 481              		.global	DMA2_Stream2_IRQHandler
 482              		.thumb
 483              		.thumb_func
 485              	DMA2_Stream2_IRQHandler:
 486              	.LFB111:
 212:App/STM32F4-Discovery/spi.c **** 
 213:App/STM32F4-Discovery/spi.c **** void DMA2_Stream2_IRQHandler()
 214:App/STM32F4-Discovery/spi.c **** {
 487              		.loc 1 214 0
 488              		.cfi_startproc
 489              		@ args = 0, pretend = 0, frame = 0
 490              		@ frame_needed = 1, uses_anonymous_args = 0
 491 0000 80B5     		push	{r7, lr}
 492              	.LCFI3:
 493              		.cfi_def_cfa_offset 8
 494              		.cfi_offset 7, -8
 495              		.cfi_offset 14, -4
 496 0002 00AF     		add	r7, sp, #0
 497              	.LCFI4:
 498              		.cfi_def_cfa_register 7
 215:App/STM32F4-Discovery/spi.c ****   // Test if DMA Stream Transfer Complete interrupt
 216:App/STM32F4-Discovery/spi.c ****   if (DMA_GetITStatus (SPIx_RX_DMA_STREAM, DMA_IT_TCIF2)) {
 499              		.loc 1 216 0
 500 0004 1D48     		ldr	r0, .L10
 501 0006 1E49     		ldr	r1, .L10+4
 502 0008 FFF7FEFF 		bl	DMA_GetITStatus
 503 000c 0346     		mov	r3, r0
 504 000e 002B     		cmp	r3, #0
 505 0010 2AD0     		beq	.L7
 217:App/STM32F4-Discovery/spi.c ****     
 218:App/STM32F4-Discovery/spi.c **** 	DMA_ClearITPendingBit (SPIx_RX_DMA_STREAM, DMA_IT_TCIF2);
 506              		.loc 1 218 0
 507 0012 1A48     		ldr	r0, .L10
 508 0014 1A49     		ldr	r1, .L10+4
 509 0016 FFF7FEFF 		bl	DMA_ClearITPendingBit
 219:App/STM32F4-Discovery/spi.c **** 	
 220:App/STM32F4-Discovery/spi.c **** 	while (SPI_I2S_GetFlagStatus (SPIx, SPI_I2S_FLAG_BSY) == SET);
 510              		.loc 1 220 0
 511 001a 00BF     		nop
 512              	.L8:
 513              		.loc 1 220 0 is_stmt 0 discriminator 1
 514 001c 1948     		ldr	r0, .L10+8
 515 001e 8021     		movs	r1, #128
 516 0020 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 517 0024 0346     		mov	r3, r0
 518 0026 012B     		cmp	r3, #1
 519 0028 F8D0     		beq	.L8
 221:App/STM32F4-Discovery/spi.c ****     /*
 222:App/STM32F4-Discovery/spi.c ****      * The DMA stream is disabled in hardware at the end of the transfer
 223:App/STM32F4-Discovery/spi.c ****      * Now we can deselect the display. If more than one peripheral was being run
 224:App/STM32F4-Discovery/spi.c ****      * on this SPI peripheral, we would have to do both/all of them, or work out
 225:App/STM32F4-Discovery/spi.c ****      * which one was active and deselect that one.i
 226:App/STM32F4-Discovery/spi.c **** 	
 227:App/STM32F4-Discovery/spi.c ****      */
 228:App/STM32F4-Discovery/spi.c **** 	CSOFF();
 520              		.loc 1 228 0 is_stmt 1
 521 002a 174B     		ldr	r3, .L10+12
 522 002c 164A     		ldr	r2, .L10+12
 523 002e 128B     		ldrh	r2, [r2, #24]	@ movhi
 524 0030 92B2     		uxth	r2, r2
 525 0032 42F01002 		orr	r2, r2, #16
 526 0036 92B2     		uxth	r2, r2
 527 0038 1A83     		strh	r2, [r3, #24]	@ movhi
 229:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, DISABLE);		
 528              		.loc 1 229 0
 529 003a 1448     		ldr	r0, .L10+16
 530 003c 0021     		movs	r1, #0
 531 003e FFF7FEFF 		bl	DMA_Cmd
 230:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, DISABLE);		
 532              		.loc 1 230 0
 533 0042 0E48     		ldr	r0, .L10
 534 0044 0021     		movs	r1, #0
 535 0046 FFF7FEFF 		bl	DMA_Cmd
 231:App/STM32F4-Discovery/spi.c ****  
 232:App/STM32F4-Discovery/spi.c **** 	taskENTER_CRITICAL(); 
 536              		.loc 1 232 0
 537 004a FFF7FEFF 		bl	vPortEnterCritical
 233:App/STM32F4-Discovery/spi.c **** //       xSemaphoreGive( xSemaphoreDMASPI);
 234:App/STM32F4-Discovery/spi.c **** 	xHigherPriorityTaskWoken = pdFalse;
 538              		.loc 1 234 0
 539 004e 104B     		ldr	r3, .L10+20
 540 0050 0022     		movs	r2, #0
 541 0052 1A60     		str	r2, [r3]
 235:App/STM32F4-Discovery/spi.c **** 	xSemaphoreGiveFromISR( xSemaphoreDMASPI, &xHigherPriorityTaskWoken );
 542              		.loc 1 235 0
 543 0054 0F4B     		ldr	r3, .L10+24
 544 0056 1B68     		ldr	r3, [r3]
 545 0058 1846     		mov	r0, r3
 546 005a 0021     		movs	r1, #0
 547 005c 0C4A     		ldr	r2, .L10+20
 548 005e 0023     		movs	r3, #0
 549 0060 FFF7FEFF 		bl	xQueueGenericSendFromISR
 236:App/STM32F4-Discovery/spi.c **** 	taskEXIT_CRITICAL(); //
 550              		.loc 1 236 0
 551 0064 FFF7FEFF 		bl	vPortExitCritical
 552              	.L7:
 237:App/STM32F4-Discovery/spi.c ****   }	
 238:App/STM32F4-Discovery/spi.c **** 
 239:App/STM32F4-Discovery/spi.c ****   portYIELD_FROM_ISR( xHigherPriorityTaskWoken );
 553              		.loc 1 239 0
 554 0068 094B     		ldr	r3, .L10+20
 555 006a 1B68     		ldr	r3, [r3]
 556 006c 002B     		cmp	r3, #0
 557 006e 03D0     		beq	.L6
 558              		.loc 1 239 0 is_stmt 0 discriminator 1
 559 0070 094B     		ldr	r3, .L10+28
 560 0072 4FF08052 		mov	r2, #268435456
 561 0076 1A60     		str	r2, [r3]
 562              	.L6:
 240:App/STM32F4-Discovery/spi.c **** }
 563              		.loc 1 240 0 is_stmt 1
 564 0078 80BD     		pop	{r7, pc}
 565              	.L11:
 566 007a 00BF     		.align	2
 567              	.L10:
 568 007c 40640240 		.word	1073898560
 569 0080 00802010 		.word	270565376
 570 0084 00300140 		.word	1073819648
 571 0088 00000240 		.word	1073872896
 572 008c 58640240 		.word	1073898584
 573 0090 00000000 		.word	xHigherPriorityTaskWoken
 574 0094 00000000 		.word	xSemaphoreDMASPI
 575 0098 04ED00E0 		.word	-536810236
 576              		.cfi_endproc
 577              	.LFE111:
 579              		.section	.text.DMA2_Stream3_IRQHandler,"ax",%progbits
 580              		.align	2
 581              		.global	DMA2_Stream3_IRQHandler
 582              		.thumb
 583              		.thumb_func
 585              	DMA2_Stream3_IRQHandler:
 586              	.LFB112:
 241:App/STM32F4-Discovery/spi.c **** void DMA2_Stream3_IRQHandler()
 242:App/STM32F4-Discovery/spi.c **** {
 587              		.loc 1 242 0
 588              		.cfi_startproc
 589              		@ args = 0, pretend = 0, frame = 0
 590              		@ frame_needed = 1, uses_anonymous_args = 0
 591 0000 80B5     		push	{r7, lr}
 592              	.LCFI5:
 593              		.cfi_def_cfa_offset 8
 594              		.cfi_offset 7, -8
 595              		.cfi_offset 14, -4
 596 0002 00AF     		add	r7, sp, #0
 597              	.LCFI6:
 598              		.cfi_def_cfa_register 7
 243:App/STM32F4-Discovery/spi.c ****   // Test if DMA Stream Transfer Complete interrupt
 244:App/STM32F4-Discovery/spi.c ****   if (DMA_GetITStatus (SPIx_TX_DMA_STREAM, DMA_IT_TCIF3)) {
 599              		.loc 1 244 0
 600 0004 1D48     		ldr	r0, .L16
 601 0006 1E49     		ldr	r1, .L16+4
 602 0008 FFF7FEFF 		bl	DMA_GetITStatus
 603 000c 0346     		mov	r3, r0
 604 000e 002B     		cmp	r3, #0
 605 0010 2AD0     		beq	.L13
 245:App/STM32F4-Discovery/spi.c ****     
 246:App/STM32F4-Discovery/spi.c **** 	DMA_ClearITPendingBit (SPIx_TX_DMA_STREAM, DMA_IT_TCIF3);
 606              		.loc 1 246 0
 607 0012 1A48     		ldr	r0, .L16
 608 0014 1A49     		ldr	r1, .L16+4
 609 0016 FFF7FEFF 		bl	DMA_ClearITPendingBit
 247:App/STM32F4-Discovery/spi.c **** 	
 248:App/STM32F4-Discovery/spi.c **** 	while (SPI_I2S_GetFlagStatus (SPIx, SPI_I2S_FLAG_BSY) == SET);
 610              		.loc 1 248 0
 611 001a 00BF     		nop
 612              	.L14:
 613              		.loc 1 248 0 is_stmt 0 discriminator 1
 614 001c 1948     		ldr	r0, .L16+8
 615 001e 8021     		movs	r1, #128
 616 0020 FFF7FEFF 		bl	SPI_I2S_GetFlagStatus
 617 0024 0346     		mov	r3, r0
 618 0026 012B     		cmp	r3, #1
 619 0028 F8D0     		beq	.L14
 249:App/STM32F4-Discovery/spi.c ****     /*
 250:App/STM32F4-Discovery/spi.c ****      * The DMA stream is disabled in hardware at the end of the transfer
 251:App/STM32F4-Discovery/spi.c ****      * Now we can deselect the display. If more than one peripheral was being run
 252:App/STM32F4-Discovery/spi.c ****      * on this SPI peripheral, we would have to do both/all of them, or work out
 253:App/STM32F4-Discovery/spi.c ****      * which one was active and deselect that one.i
 254:App/STM32F4-Discovery/spi.c **** 	
 255:App/STM32F4-Discovery/spi.c ****      */
 256:App/STM32F4-Discovery/spi.c **** 	CSOFF();
 620              		.loc 1 256 0 is_stmt 1
 621 002a 174B     		ldr	r3, .L16+12
 622 002c 164A     		ldr	r2, .L16+12
 623 002e 128B     		ldrh	r2, [r2, #24]	@ movhi
 624 0030 92B2     		uxth	r2, r2
 625 0032 42F01002 		orr	r2, r2, #16
 626 0036 92B2     		uxth	r2, r2
 627 0038 1A83     		strh	r2, [r3, #24]	@ movhi
 257:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, DISABLE);		
 628              		.loc 1 257 0
 629 003a 1048     		ldr	r0, .L16
 630 003c 0021     		movs	r1, #0
 631 003e FFF7FEFF 		bl	DMA_Cmd
 258:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, DISABLE);		
 632              		.loc 1 258 0
 633 0042 1248     		ldr	r0, .L16+16
 634 0044 0021     		movs	r1, #0
 635 0046 FFF7FEFF 		bl	DMA_Cmd
 259:App/STM32F4-Discovery/spi.c ****        
 260:App/STM32F4-Discovery/spi.c **** 	taskENTER_CRITICAL(); 
 636              		.loc 1 260 0
 637 004a FFF7FEFF 		bl	vPortEnterCritical
 261:App/STM32F4-Discovery/spi.c **** //	 xSemaphoreGive( xSemaphoreDMASPI );
 262:App/STM32F4-Discovery/spi.c **** 	xHigherPriorityTaskWoken = pdFalse;
 638              		.loc 1 262 0
 639 004e 104B     		ldr	r3, .L16+20
 640 0050 0022     		movs	r2, #0
 641 0052 1A60     		str	r2, [r3]
 263:App/STM32F4-Discovery/spi.c **** 	xSemaphoreGiveFromISR( xSemaphoreDMASPI, &xHigherPriorityTaskWoken );
 642              		.loc 1 263 0
 643 0054 0F4B     		ldr	r3, .L16+24
 644 0056 1B68     		ldr	r3, [r3]
 645 0058 1846     		mov	r0, r3
 646 005a 0021     		movs	r1, #0
 647 005c 0C4A     		ldr	r2, .L16+20
 648 005e 0023     		movs	r3, #0
 649 0060 FFF7FEFF 		bl	xQueueGenericSendFromISR
 264:App/STM32F4-Discovery/spi.c ****  	taskEXIT_CRITICAL();  
 650              		.loc 1 264 0
 651 0064 FFF7FEFF 		bl	vPortExitCritical
 652              	.L13:
 265:App/STM32F4-Discovery/spi.c ****  }
 266:App/STM32F4-Discovery/spi.c ****   portYIELD_FROM_ISR( xHigherPriorityTaskWoken );
 653              		.loc 1 266 0
 654 0068 094B     		ldr	r3, .L16+20
 655 006a 1B68     		ldr	r3, [r3]
 656 006c 002B     		cmp	r3, #0
 657 006e 03D0     		beq	.L12
 658              		.loc 1 266 0 is_stmt 0 discriminator 1
 659 0070 094B     		ldr	r3, .L16+28
 660 0072 4FF08052 		mov	r2, #268435456
 661 0076 1A60     		str	r2, [r3]
 662              	.L12:
 267:App/STM32F4-Discovery/spi.c **** }
 663              		.loc 1 267 0 is_stmt 1
 664 0078 80BD     		pop	{r7, pc}
 665              	.L17:
 666 007a 00BF     		.align	2
 667              	.L16:
 668 007c 58640240 		.word	1073898584
 669 0080 00800018 		.word	402685952
 670 0084 00300140 		.word	1073819648
 671 0088 00000240 		.word	1073872896
 672 008c 40640240 		.word	1073898560
 673 0090 00000000 		.word	xHigherPriorityTaskWoken
 674 0094 00000000 		.word	xSemaphoreDMASPI
 675 0098 04ED00E0 		.word	-536810236
 676              		.cfi_endproc
 677              	.LFE112:
 679              		.section	.text.spi_dma_send,"ax",%progbits
 680              		.align	2
 681              		.global	spi_dma_send
 682              		.thumb
 683              		.thumb_func
 685              	spi_dma_send:
 686              	.LFB113:
 268:App/STM32F4-Discovery/spi.c **** 
 269:App/STM32F4-Discovery/spi.c **** 
 270:App/STM32F4-Discovery/spi.c **** /*---------------------------- Matic Knap 25 Jun 2014 ---------------------*/
 271:App/STM32F4-Discovery/spi.c **** 
 272:App/STM32F4-Discovery/spi.c **** void spi_dma_send(uint16_t address, uint16_t data_len, uint8_t *data_buf)
 273:App/STM32F4-Discovery/spi.c **** {
 687              		.loc 1 273 0
 688              		.cfi_startproc
 689              		@ args = 0, pretend = 0, frame = 24
 690              		@ frame_needed = 1, uses_anonymous_args = 0
 691 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 692              	.LCFI7:
 693              		.cfi_def_cfa_offset 28
 694              		.cfi_offset 4, -28
 695              		.cfi_offset 5, -24
 696              		.cfi_offset 6, -20
 697              		.cfi_offset 7, -16
 698              		.cfi_offset 8, -12
 699              		.cfi_offset 9, -8
 700              		.cfi_offset 14, -4
 701 0004 87B0     		sub	sp, sp, #28
 702              	.LCFI8:
 703              		.cfi_def_cfa_offset 56
 704 0006 00AF     		add	r7, sp, #0
 705              	.LCFI9:
 706              		.cfi_def_cfa_register 7
 707 0008 0B46     		mov	r3, r1
 708 000a 3A60     		str	r2, [r7]
 709 000c 0246     		mov	r2, r0	@ movhi
 710 000e FA80     		strh	r2, [r7, #6]	@ movhi
 711 0010 BB80     		strh	r3, [r7, #4]	@ movhi
 712 0012 6B46     		mov	r3, sp
 713 0014 1E46     		mov	r6, r3
 274:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[data_len+4];
 714              		.loc 1 274 0
 715 0016 BB88     		ldrh	r3, [r7, #4]
 716 0018 191D     		adds	r1, r3, #4
 717 001a 4B1E     		subs	r3, r1, #1
 718 001c 3B61     		str	r3, [r7, #16]
 719 001e 0B46     		mov	r3, r1
 720 0020 1A46     		mov	r2, r3
 721 0022 4FF00003 		mov	r3, #0
 722 0026 4FEAC309 		lsl	r9, r3, #3
 723 002a 49EA5279 		orr	r9, r9, r2, lsr #29
 724 002e 4FEAC208 		lsl	r8, r2, #3
 725 0032 0B46     		mov	r3, r1
 726 0034 1A46     		mov	r2, r3
 727 0036 4FF00003 		mov	r3, #0
 728 003a DD00     		lsls	r5, r3, #3
 729 003c 45EA5275 		orr	r5, r5, r2, lsr #29
 730 0040 D400     		lsls	r4, r2, #3
 731 0042 0B46     		mov	r3, r1
 732 0044 0733     		adds	r3, r3, #7
 733 0046 DB08     		lsrs	r3, r3, #3
 734 0048 DB00     		lsls	r3, r3, #3
 735 004a ADEB030D 		sub	sp, sp, r3
 736 004e 6B46     		mov	r3, sp
 737 0050 0033     		adds	r3, r3, #0
 738 0052 FB60     		str	r3, [r7, #12]
 275:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 739              		.loc 1 275 0
 740 0054 FB88     		ldrh	r3, [r7, #6]
 741 0056 1B0A     		lsrs	r3, r3, #8
 742 0058 9BB2     		uxth	r3, r3
 743 005a DAB2     		uxtb	r2, r3
 744 005c FB68     		ldr	r3, [r7, #12]
 745 005e 1A70     		strb	r2, [r3]
 276:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 746              		.loc 1 276 0
 747 0060 FB88     		ldrh	r3, [r7, #6]	@ movhi
 748 0062 DAB2     		uxtb	r2, r3
 749 0064 FB68     		ldr	r3, [r7, #12]
 750 0066 5A70     		strb	r2, [r3, #1]
 277:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 751              		.loc 1 277 0
 752 0068 BB88     		ldrh	r3, [r7, #4]
 753 006a 03F4FE43 		and	r3, r3, #32512
 754 006e 1B12     		asrs	r3, r3, #8
 755 0070 DBB2     		uxtb	r3, r3
 756 0072 63F07F03 		orn	r3, r3, #127
 757 0076 DBB2     		uxtb	r3, r3
 758 0078 DAB2     		uxtb	r2, r3
 759 007a FB68     		ldr	r3, [r7, #12]
 760 007c 9A70     		strb	r2, [r3, #2]
 278:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 761              		.loc 1 278 0
 762 007e BB88     		ldrh	r3, [r7, #4]	@ movhi
 763 0080 DAB2     		uxtb	r2, r3
 764 0082 FB68     		ldr	r3, [r7, #12]
 765 0084 DA70     		strb	r2, [r3, #3]
 279:App/STM32F4-Discovery/spi.c **** 
 280:App/STM32F4-Discovery/spi.c **** 		int i;
 281:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 766              		.loc 1 281 0
 767 0086 0423     		movs	r3, #4
 768 0088 7B61     		str	r3, [r7, #20]
 769 008a 0BE0     		b	.L19
 770              	.L20:
 282:App/STM32F4-Discovery/spi.c **** 			buffer[i] = (data_buf[i-4]);
 771              		.loc 1 282 0 discriminator 2
 772 008c 7B69     		ldr	r3, [r7, #20]
 773 008e 043B     		subs	r3, r3, #4
 774 0090 3A68     		ldr	r2, [r7]
 775 0092 1344     		add	r3, r3, r2
 776 0094 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 777 0096 F968     		ldr	r1, [r7, #12]
 778 0098 7B69     		ldr	r3, [r7, #20]
 779 009a 0B44     		add	r3, r3, r1
 780 009c 1A70     		strb	r2, [r3]
 281:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 781              		.loc 1 281 0 discriminator 2
 782 009e 7B69     		ldr	r3, [r7, #20]
 783 00a0 0133     		adds	r3, r3, #1
 784 00a2 7B61     		str	r3, [r7, #20]
 785              	.L19:
 281:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) 
 786              		.loc 1 281 0 is_stmt 0 discriminator 1
 787 00a4 BB88     		ldrh	r3, [r7, #4]
 788 00a6 1A1D     		adds	r2, r3, #4
 789 00a8 7B69     		ldr	r3, [r7, #20]
 790 00aa 9A42     		cmp	r2, r3
 791 00ac EEDC     		bgt	.L20
 283:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, data_len + 4);
 792              		.loc 1 283 0 is_stmt 1
 793 00ae BB88     		ldrh	r3, [r7, #4]	@ movhi
 794 00b0 0433     		adds	r3, r3, #4
 795 00b2 9BB2     		uxth	r3, r3
 796 00b4 1248     		ldr	r0, .L21
 797 00b6 1946     		mov	r1, r3
 798 00b8 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 284:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 799              		.loc 1 284 0
 800 00bc 104B     		ldr	r3, .L21
 801 00be FA68     		ldr	r2, [r7, #12]
 802 00c0 DA60     		str	r2, [r3, #12]
 285:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 803              		.loc 1 285 0
 804 00c2 104B     		ldr	r3, .L21+4
 805 00c4 0F4A     		ldr	r2, .L21+4
 806 00c6 528B     		ldrh	r2, [r2, #26]	@ movhi
 807 00c8 92B2     		uxth	r2, r2
 808 00ca 42F01002 		orr	r2, r2, #16
 809 00ce 92B2     		uxth	r2, r2
 810 00d0 5A83     		strh	r2, [r3, #26]	@ movhi
 286:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 811              		.loc 1 286 0
 812 00d2 0B48     		ldr	r0, .L21
 813 00d4 0121     		movs	r1, #1
 814 00d6 FFF7FEFF 		bl	DMA_Cmd
 287:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);	
 815              		.loc 1 287 0
 816 00da 0B48     		ldr	r0, .L21+8
 817 00dc 0121     		movs	r1, #1
 818 00de FFF7FEFF 		bl	DMA_Cmd
 288:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 289:App/STM32F4-Discovery/spi.c ****         	 xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);
 819              		.loc 1 289 0
 820 00e2 0A4B     		ldr	r3, .L21+12
 821 00e4 1B68     		ldr	r3, [r3]
 822 00e6 1846     		mov	r0, r3
 823 00e8 0021     		movs	r1, #0
 824 00ea 4FF0FF32 		mov	r2, #-1
 825 00ee 0023     		movs	r3, #0
 826 00f0 FFF7FEFF 		bl	xQueueGenericReceive
 827 00f4 B546     		mov	sp, r6
 290:App/STM32F4-Discovery/spi.c **** 
 291:App/STM32F4-Discovery/spi.c **** 	//	CSOFF(); // chip deselect 
 292:App/STM32F4-Discovery/spi.c **** 			
 293:App/STM32F4-Discovery/spi.c **** 	
 294:App/STM32F4-Discovery/spi.c **** }
 828              		.loc 1 294 0
 829 00f6 1C37     		adds	r7, r7, #28
 830 00f8 BD46     		mov	sp, r7
 831              		@ sp needed
 832 00fa BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 833              	.L22:
 834 00fe 00BF     		.align	2
 835              	.L21:
 836 0100 58640240 		.word	1073898584
 837 0104 00000240 		.word	1073872896
 838 0108 40640240 		.word	1073898560
 839 010c 00000000 		.word	xSemaphoreDMASPI
 840              		.cfi_endproc
 841              	.LFE113:
 843              		.section	.text.spi_dma_send2B,"ax",%progbits
 844              		.align	2
 845              		.global	spi_dma_send2B
 846              		.thumb
 847              		.thumb_func
 849              	spi_dma_send2B:
 850              	.LFB114:
 295:App/STM32F4-Discovery/spi.c **** 
 296:App/STM32F4-Discovery/spi.c **** void spi_dma_send2B(uint16_t address,  uint16_t data_buf)
 297:App/STM32F4-Discovery/spi.c **** {
 851              		.loc 1 297 0
 852              		.cfi_startproc
 853              		@ args = 0, pretend = 0, frame = 16
 854              		@ frame_needed = 1, uses_anonymous_args = 0
 855 0000 80B5     		push	{r7, lr}
 856              	.LCFI10:
 857              		.cfi_def_cfa_offset 8
 858              		.cfi_offset 7, -8
 859              		.cfi_offset 14, -4
 860 0002 84B0     		sub	sp, sp, #16
 861              	.LCFI11:
 862              		.cfi_def_cfa_offset 24
 863 0004 00AF     		add	r7, sp, #0
 864              	.LCFI12:
 865              		.cfi_def_cfa_register 7
 866 0006 0246     		mov	r2, r0
 867 0008 0B46     		mov	r3, r1
 868 000a FA80     		strh	r2, [r7, #6]	@ movhi
 869 000c BB80     		strh	r3, [r7, #4]	@ movhi
 298:App/STM32F4-Discovery/spi.c **** 	uint8_t buffer[6];
 299:App/STM32F4-Discovery/spi.c **** 	uint16_t data_len = 2;
 870              		.loc 1 299 0
 871 000e 0223     		movs	r3, #2
 872 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 300:App/STM32F4-Discovery/spi.c **** 	buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 873              		.loc 1 300 0
 874 0012 FB88     		ldrh	r3, [r7, #6]
 875 0014 1B0A     		lsrs	r3, r3, #8
 876 0016 9BB2     		uxth	r3, r3
 877 0018 DBB2     		uxtb	r3, r3
 878 001a 3B72     		strb	r3, [r7, #8]
 301:App/STM32F4-Discovery/spi.c **** 	buffer[1] = ((address & 0x00ff)); //address byte 2 
 879              		.loc 1 301 0
 880 001c FB88     		ldrh	r3, [r7, #6]	@ movhi
 881 001e DBB2     		uxtb	r3, r3
 882 0020 7B72     		strb	r3, [r7, #9]
 302:App/STM32F4-Discovery/spi.c **** 	buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 883              		.loc 1 302 0
 884 0022 FB89     		ldrh	r3, [r7, #14]
 885 0024 03F4FE43 		and	r3, r3, #32512
 886 0028 1B12     		asrs	r3, r3, #8
 887 002a DBB2     		uxtb	r3, r3
 888 002c 63F07F03 		orn	r3, r3, #127
 889 0030 DBB2     		uxtb	r3, r3
 890 0032 DBB2     		uxtb	r3, r3
 891 0034 BB72     		strb	r3, [r7, #10]
 303:App/STM32F4-Discovery/spi.c **** 	 buffer[3] = (data_len & 0x00ff);
 892              		.loc 1 303 0
 893 0036 FB89     		ldrh	r3, [r7, #14]	@ movhi
 894 0038 DBB2     		uxtb	r3, r3
 895 003a FB72     		strb	r3, [r7, #11]
 304:App/STM32F4-Discovery/spi.c **** 	 buffer[4] = ((data_buf & 0xff00) >> 8);
 896              		.loc 1 304 0
 897 003c BB88     		ldrh	r3, [r7, #4]
 898 003e 1B0A     		lsrs	r3, r3, #8
 899 0040 9BB2     		uxth	r3, r3
 900 0042 DBB2     		uxtb	r3, r3
 901 0044 3B73     		strb	r3, [r7, #12]
 305:App/STM32F4-Discovery/spi.c **** 	 buffer[5] = (data_buf & 0x00ff);
 902              		.loc 1 305 0
 903 0046 BB88     		ldrh	r3, [r7, #4]	@ movhi
 904 0048 DBB2     		uxtb	r3, r3
 905 004a 7B73     		strb	r3, [r7, #13]
 306:App/STM32F4-Discovery/spi.c **** 	DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 6);
 906              		.loc 1 306 0
 907 004c 1148     		ldr	r0, .L24
 908 004e 0621     		movs	r1, #6
 909 0050 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 307:App/STM32F4-Discovery/spi.c **** 	SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 910              		.loc 1 307 0
 911 0054 0F4B     		ldr	r3, .L24
 912 0056 07F10802 		add	r2, r7, #8
 913 005a DA60     		str	r2, [r3, #12]
 308:App/STM32F4-Discovery/spi.c **** 	CSON(); // chip select 
 914              		.loc 1 308 0
 915 005c 0E4B     		ldr	r3, .L24+4
 916 005e 0E4A     		ldr	r2, .L24+4
 917 0060 528B     		ldrh	r2, [r2, #26]	@ movhi
 918 0062 92B2     		uxth	r2, r2
 919 0064 42F01002 		orr	r2, r2, #16
 920 0068 92B2     		uxth	r2, r2
 921 006a 5A83     		strh	r2, [r3, #26]	@ movhi
 309:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 922              		.loc 1 309 0
 923 006c 0948     		ldr	r0, .L24
 924 006e 0121     		movs	r1, #1
 925 0070 FFF7FEFF 		bl	DMA_Cmd
 310:App/STM32F4-Discovery/spi.c **** 	DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);	
 926              		.loc 1 310 0
 927 0074 0948     		ldr	r0, .L24+8
 928 0076 0121     		movs	r1, #1
 929 0078 FFF7FEFF 		bl	DMA_Cmd
 311:App/STM32F4-Discovery/spi.c **** 	/* Block until the semaphore is given */
 312:App/STM32F4-Discovery/spi.c ****         xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 930              		.loc 1 312 0
 931 007c 084B     		ldr	r3, .L24+12
 932 007e 1B68     		ldr	r3, [r3]
 933 0080 1846     		mov	r0, r3
 934 0082 0021     		movs	r1, #0
 935 0084 4FF0FF32 		mov	r2, #-1
 936 0088 0023     		movs	r3, #0
 937 008a FFF7FEFF 		bl	xQueueGenericReceive
 313:App/STM32F4-Discovery/spi.c **** 	
 314:App/STM32F4-Discovery/spi.c **** //	CSOFF(); // chip deselect 
 315:App/STM32F4-Discovery/spi.c **** 			
 316:App/STM32F4-Discovery/spi.c **** }
 938              		.loc 1 316 0
 939 008e 1037     		adds	r7, r7, #16
 940 0090 BD46     		mov	sp, r7
 941              		@ sp needed
 942 0092 80BD     		pop	{r7, pc}
 943              	.L25:
 944              		.align	2
 945              	.L24:
 946 0094 58640240 		.word	1073898584
 947 0098 00000240 		.word	1073872896
 948 009c 40640240 		.word	1073898560
 949 00a0 00000000 		.word	xSemaphoreDMASPI
 950              		.cfi_endproc
 951              	.LFE114:
 953              		.section	.text.spi_dma_sendByte,"ax",%progbits
 954              		.align	2
 955              		.global	spi_dma_sendByte
 956              		.thumb
 957              		.thumb_func
 959              	spi_dma_sendByte:
 960              	.LFB115:
 317:App/STM32F4-Discovery/spi.c **** 
 318:App/STM32F4-Discovery/spi.c **** void spi_dma_sendByte(uint16_t address,  uint8_t data_buf)
 319:App/STM32F4-Discovery/spi.c **** {
 961              		.loc 1 319 0
 962              		.cfi_startproc
 963              		@ args = 0, pretend = 0, frame = 16
 964              		@ frame_needed = 1, uses_anonymous_args = 0
 965 0000 80B5     		push	{r7, lr}
 966              	.LCFI13:
 967              		.cfi_def_cfa_offset 8
 968              		.cfi_offset 7, -8
 969              		.cfi_offset 14, -4
 970 0002 84B0     		sub	sp, sp, #16
 971              	.LCFI14:
 972              		.cfi_def_cfa_offset 24
 973 0004 00AF     		add	r7, sp, #0
 974              	.LCFI15:
 975              		.cfi_def_cfa_register 7
 976 0006 0246     		mov	r2, r0
 977 0008 0B46     		mov	r3, r1
 978 000a FA80     		strh	r2, [r7, #6]	@ movhi
 979 000c 7B71     		strb	r3, [r7, #5]
 320:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[5];
 321:App/STM32F4-Discovery/spi.c **** 		uint16_t data_len=0x1;
 980              		.loc 1 321 0
 981 000e 0123     		movs	r3, #1
 982 0010 FB81     		strh	r3, [r7, #14]	@ movhi
 322:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 983              		.loc 1 322 0
 984 0012 FB88     		ldrh	r3, [r7, #6]
 985 0014 1B0A     		lsrs	r3, r3, #8
 986 0016 9BB2     		uxth	r3, r3
 987 0018 DBB2     		uxtb	r3, r3
 988 001a 3B72     		strb	r3, [r7, #8]
 323:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 989              		.loc 1 323 0
 990 001c FB88     		ldrh	r3, [r7, #6]	@ movhi
 991 001e DBB2     		uxtb	r3, r3
 992 0020 7B72     		strb	r3, [r7, #9]
 324:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x80 | (data_len & 0x7f00) >> 8 ));
 993              		.loc 1 324 0
 994 0022 FB89     		ldrh	r3, [r7, #14]
 995 0024 03F4FE43 		and	r3, r3, #32512
 996 0028 1B12     		asrs	r3, r3, #8
 997 002a DBB2     		uxtb	r3, r3
 998 002c 63F07F03 		orn	r3, r3, #127
 999 0030 DBB2     		uxtb	r3, r3
 1000 0032 DBB2     		uxtb	r3, r3
 1001 0034 BB72     		strb	r3, [r7, #10]
 325:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 1002              		.loc 1 325 0
 1003 0036 FB89     		ldrh	r3, [r7, #14]	@ movhi
 1004 0038 DBB2     		uxtb	r3, r3
 1005 003a FB72     		strb	r3, [r7, #11]
 326:App/STM32F4-Discovery/spi.c **** 		buffer[4] = data_buf ; 
 1006              		.loc 1 326 0
 1007 003c 7B79     		ldrb	r3, [r7, #5]
 1008 003e 3B73     		strb	r3, [r7, #12]
 327:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 5);
 1009              		.loc 1 327 0
 1010 0040 1148     		ldr	r0, .L27
 1011 0042 0521     		movs	r1, #5
 1012 0044 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 328:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 1013              		.loc 1 328 0
 1014 0048 0F4B     		ldr	r3, .L27
 1015 004a 07F10802 		add	r2, r7, #8
 1016 004e DA60     		str	r2, [r3, #12]
 329:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1017              		.loc 1 329 0
 1018 0050 0E4B     		ldr	r3, .L27+4
 1019 0052 0E4A     		ldr	r2, .L27+4
 1020 0054 528B     		ldrh	r2, [r2, #26]	@ movhi
 1021 0056 92B2     		uxth	r2, r2
 1022 0058 42F01002 		orr	r2, r2, #16
 1023 005c 92B2     		uxth	r2, r2
 1024 005e 5A83     		strh	r2, [r3, #26]	@ movhi
 330:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1025              		.loc 1 330 0
 1026 0060 0948     		ldr	r0, .L27
 1027 0062 0121     		movs	r1, #1
 1028 0064 FFF7FEFF 		bl	DMA_Cmd
 331:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1029              		.loc 1 331 0
 1030 0068 0948     		ldr	r0, .L27+8
 1031 006a 0121     		movs	r1, #1
 1032 006c FFF7FEFF 		bl	DMA_Cmd
 332:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 333:App/STM32F4-Discovery/spi.c **** 	        xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 1033              		.loc 1 333 0
 1034 0070 084B     		ldr	r3, .L27+12
 1035 0072 1B68     		ldr	r3, [r3]
 1036 0074 1846     		mov	r0, r3
 1037 0076 0021     		movs	r1, #0
 1038 0078 4FF0FF32 		mov	r2, #-1
 1039 007c 0023     		movs	r3, #0
 1040 007e FFF7FEFF 		bl	xQueueGenericReceive
 334:App/STM32F4-Discovery/spi.c **** 				
 335:App/STM32F4-Discovery/spi.c **** //		CSOFF(); // chip deselect 
 336:App/STM32F4-Discovery/spi.c **** 			
 337:App/STM32F4-Discovery/spi.c **** }
 1041              		.loc 1 337 0
 1042 0082 1037     		adds	r7, r7, #16
 1043 0084 BD46     		mov	sp, r7
 1044              		@ sp needed
 1045 0086 80BD     		pop	{r7, pc}
 1046              	.L28:
 1047              		.align	2
 1048              	.L27:
 1049 0088 58640240 		.word	1073898584
 1050 008c 00000240 		.word	1073872896
 1051 0090 40640240 		.word	1073898560
 1052 0094 00000000 		.word	xSemaphoreDMASPI
 1053              		.cfi_endproc
 1054              	.LFE115:
 1056              		.section	.text.spi_dma_read2B,"ax",%progbits
 1057              		.align	2
 1058              		.global	spi_dma_read2B
 1059              		.thumb
 1060              		.thumb_func
 1062              	spi_dma_read2B:
 1063              	.LFB116:
 338:App/STM32F4-Discovery/spi.c **** 
 339:App/STM32F4-Discovery/spi.c **** 
 340:App/STM32F4-Discovery/spi.c **** uint16_t spi_dma_read2B(uint16_t address)
 341:App/STM32F4-Discovery/spi.c **** {
 1064              		.loc 1 341 0
 1065              		.cfi_startproc
 1066              		@ args = 0, pretend = 0, frame = 24
 1067              		@ frame_needed = 1, uses_anonymous_args = 0
 1068 0000 80B5     		push	{r7, lr}
 1069              	.LCFI16:
 1070              		.cfi_def_cfa_offset 8
 1071              		.cfi_offset 7, -8
 1072              		.cfi_offset 14, -4
 1073 0002 86B0     		sub	sp, sp, #24
 1074              	.LCFI17:
 1075              		.cfi_def_cfa_offset 32
 1076 0004 00AF     		add	r7, sp, #0
 1077              	.LCFI18:
 1078              		.cfi_def_cfa_register 7
 1079 0006 0346     		mov	r3, r0
 1080 0008 FB80     		strh	r3, [r7, #6]	@ movhi
 342:App/STM32F4-Discovery/spi.c **** 		uint16_t data_len = 2; 
 1081              		.loc 1 342 0
 1082 000a 0223     		movs	r3, #2
 1083 000c 7B82     		strh	r3, [r7, #18]	@ movhi
 343:App/STM32F4-Discovery/spi.c **** 		uint8_t data_buf[4];
 344:App/STM32F4-Discovery/spi.c **** 		
 345:App/STM32F4-Discovery/spi.c **** 		data_buf[0] = ((address & 0xff00) >> 8); // addres byte 1 
 1084              		.loc 1 345 0
 1085 000e FB88     		ldrh	r3, [r7, #6]
 1086 0010 1B0A     		lsrs	r3, r3, #8
 1087 0012 9BB2     		uxth	r3, r3
 1088 0014 DBB2     		uxtb	r3, r3
 1089 0016 3B73     		strb	r3, [r7, #12]
 346:App/STM32F4-Discovery/spi.c **** 		data_buf[1] = ((address & 0x00ff)); //address byte 2 
 1090              		.loc 1 346 0
 1091 0018 FB88     		ldrh	r3, [r7, #6]	@ movhi
 1092 001a DBB2     		uxtb	r3, r3
 1093 001c 7B73     		strb	r3, [r7, #13]
 347:App/STM32F4-Discovery/spi.c **** 		data_buf[2] = ((0x00 | (data_len & 0x7f00) >> 8 ));
 1094              		.loc 1 347 0
 1095 001e 7B8A     		ldrh	r3, [r7, #18]
 1096 0020 03F4FE43 		and	r3, r3, #32512
 1097 0024 1B12     		asrs	r3, r3, #8
 1098 0026 DBB2     		uxtb	r3, r3
 1099 0028 BB73     		strb	r3, [r7, #14]
 348:App/STM32F4-Discovery/spi.c **** 		data_buf[3] = (data_len & 0x00ff);
 1100              		.loc 1 348 0
 1101 002a 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1102 002c DBB2     		uxtb	r3, r3
 1103 002e FB73     		strb	r3, [r7, #15]
 349:App/STM32F4-Discovery/spi.c **** 
 350:App/STM32F4-Discovery/spi.c **** 		int i;
 351:App/STM32F4-Discovery/spi.c **** 		for (i = 0; i < data_len; i++) data_buf[i] = 0x0;
 1104              		.loc 1 351 0
 1105 0030 0023     		movs	r3, #0
 1106 0032 7B61     		str	r3, [r7, #20]
 1107 0034 08E0     		b	.L30
 1108              	.L31:
 1109              		.loc 1 351 0 is_stmt 0 discriminator 2
 1110 0036 07F10C02 		add	r2, r7, #12
 1111 003a 7B69     		ldr	r3, [r7, #20]
 1112 003c 1344     		add	r3, r3, r2
 1113 003e 0022     		movs	r2, #0
 1114 0040 1A70     		strb	r2, [r3]
 1115 0042 7B69     		ldr	r3, [r7, #20]
 1116 0044 0133     		adds	r3, r3, #1
 1117 0046 7B61     		str	r3, [r7, #20]
 1118              	.L30:
 1119              		.loc 1 351 0 discriminator 1
 1120 0048 7A8A     		ldrh	r2, [r7, #18]
 1121 004a 7B69     		ldr	r3, [r7, #20]
 1122 004c 9A42     		cmp	r2, r3
 1123 004e F2DC     		bgt	.L31
 352:App/STM32F4-Discovery/spi.c **** 
 353:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_RX_DMA_STREAM, data_len+4);
 1124              		.loc 1 353 0 is_stmt 1
 1125 0050 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1126 0052 0433     		adds	r3, r3, #4
 1127 0054 9BB2     		uxth	r3, r3
 1128 0056 1648     		ldr	r0, .L33
 1129 0058 1946     		mov	r1, r3
 1130 005a FFF7FEFF 		bl	DMA_SetCurrDataCounter
 354:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 4+data_len);
 1131              		.loc 1 354 0
 1132 005e 7B8A     		ldrh	r3, [r7, #18]	@ movhi
 1133 0060 0433     		adds	r3, r3, #4
 1134 0062 9BB2     		uxth	r3, r3
 1135 0064 1348     		ldr	r0, .L33+4
 1136 0066 1946     		mov	r1, r3
 1137 0068 FFF7FEFF 		bl	DMA_SetCurrDataCounter
 355:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &bufferTX;	
 1138              		.loc 1 355 0
 1139 006c 114B     		ldr	r3, .L33+4
 1140 006e 124A     		ldr	r2, .L33+8
 1141 0070 DA60     		str	r2, [r3, #12]
 356:App/STM32F4-Discovery/spi.c **** 		SPIx_RX_DMA_STREAM->M0AR =(uint32_t)&bufferRX;	
 1142              		.loc 1 356 0
 1143 0072 0F4B     		ldr	r3, .L33
 1144 0074 114A     		ldr	r2, .L33+12
 1145 0076 DA60     		str	r2, [r3, #12]
 357:App/STM32F4-Discovery/spi.c **** 
 358:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1146              		.loc 1 358 0
 1147 0078 114B     		ldr	r3, .L33+16
 1148 007a 114A     		ldr	r2, .L33+16
 1149 007c 528B     		ldrh	r2, [r2, #26]	@ movhi
 1150 007e 92B2     		uxth	r2, r2
 1151 0080 42F01002 		orr	r2, r2, #16
 1152 0084 92B2     		uxth	r2, r2
 1153 0086 5A83     		strh	r2, [r3, #26]	@ movhi
 359:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1154              		.loc 1 359 0
 1155 0088 0A48     		ldr	r0, .L33+4
 1156 008a 0121     		movs	r1, #1
 1157 008c FFF7FEFF 		bl	DMA_Cmd
 360:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1158              		.loc 1 360 0
 1159 0090 0748     		ldr	r0, .L33
 1160 0092 0121     		movs	r1, #1
 1161 0094 FFF7FEFF 		bl	DMA_Cmd
 361:App/STM32F4-Discovery/spi.c **** 		//CSOFF(); // chip deselect		
 362:App/STM32F4-Discovery/spi.c **** 
 363:App/STM32F4-Discovery/spi.c **** 		return (data_buf[0] << 8) | data_buf[1];
 1162              		.loc 1 363 0
 1163 0098 3B7B     		ldrb	r3, [r7, #12]	@ zero_extendqisi2
 1164 009a 1B02     		lsls	r3, r3, #8
 1165 009c 9AB2     		uxth	r2, r3
 1166 009e 7B7B     		ldrb	r3, [r7, #13]	@ zero_extendqisi2
 1167 00a0 1343     		orrs	r3, r3, r2
 1168 00a2 9BB2     		uxth	r3, r3
 1169 00a4 9BB2     		uxth	r3, r3
 364:App/STM32F4-Discovery/spi.c **** 
 365:App/STM32F4-Discovery/spi.c **** }
 1170              		.loc 1 365 0
 1171 00a6 1846     		mov	r0, r3
 1172 00a8 1837     		adds	r7, r7, #24
 1173 00aa BD46     		mov	sp, r7
 1174              		@ sp needed
 1175 00ac 80BD     		pop	{r7, pc}
 1176              	.L34:
 1177 00ae 00BF     		.align	2
 1178              	.L33:
 1179 00b0 40640240 		.word	1073898560
 1180 00b4 58640240 		.word	1073898584
 1181 00b8 00000000 		.word	bufferTX
 1182 00bc 00000000 		.word	bufferRX
 1183 00c0 00000240 		.word	1073872896
 1184              		.cfi_endproc
 1185              	.LFE116:
 1187              		.section	.text.spi_dma_read,"ax",%progbits
 1188              		.align	2
 1189              		.global	spi_dma_read
 1190              		.thumb
 1191              		.thumb_func
 1193              	spi_dma_read:
 1194              	.LFB117:
 366:App/STM32F4-Discovery/spi.c **** void spi_dma_read(uint16_t address, uint16_t data_len)
 367:App/STM32F4-Discovery/spi.c **** {
 1195              		.loc 1 367 0
 1196              		.cfi_startproc
 1197              		@ args = 0, pretend = 0, frame = 24
 1198              		@ frame_needed = 1, uses_anonymous_args = 0
 1199 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1200              	.LCFI19:
 1201              		.cfi_def_cfa_offset 24
 1202              		.cfi_offset 4, -24
 1203              		.cfi_offset 5, -20
 1204              		.cfi_offset 6, -16
 1205              		.cfi_offset 7, -12
 1206              		.cfi_offset 8, -8
 1207              		.cfi_offset 14, -4
 1208 0004 86B0     		sub	sp, sp, #24
 1209              	.LCFI20:
 1210              		.cfi_def_cfa_offset 48
 1211 0006 00AF     		add	r7, sp, #0
 1212              	.LCFI21:
 1213              		.cfi_def_cfa_register 7
 1214 0008 F880     		strh	r0, [r7, #6]	@ movhi
 1215 000a B980     		strh	r1, [r7, #4]	@ movhi
 1216 000c 6946     		mov	r1, sp
 1217 000e 8846     		mov	r8, r1
 368:App/STM32F4-Discovery/spi.c **** 		
 369:App/STM32F4-Discovery/spi.c **** 		/*! spi_dma_read it has to be used with \n
 370:App/STM32F4-Discovery/spi.c **** 		 * memcpy from bufferRX right after it has recieve \n
 371:App/STM32F4-Discovery/spi.c **** 		 * data on SPI. */
 372:App/STM32F4-Discovery/spi.c **** 		
 373:App/STM32F4-Discovery/spi.c **** 		uint8_t buffer[data_len+4];
 1218              		.loc 1 373 0
 1219 0010 B988     		ldrh	r1, [r7, #4]
 1220 0012 0E1D     		adds	r6, r1, #4
 1221 0014 711E     		subs	r1, r6, #1
 1222 0016 3961     		str	r1, [r7, #16]
 1223 0018 3146     		mov	r1, r6
 1224 001a 0846     		mov	r0, r1
 1225 001c 4FF00001 		mov	r1, #0
 1226 0020 CD00     		lsls	r5, r1, #3
 1227 0022 45EA5075 		orr	r5, r5, r0, lsr #29
 1228 0026 C400     		lsls	r4, r0, #3
 1229 0028 3146     		mov	r1, r6
 1230 002a 0846     		mov	r0, r1
 1231 002c 4FF00001 		mov	r1, #0
 1232 0030 CB00     		lsls	r3, r1, #3
 1233 0032 43EA5073 		orr	r3, r3, r0, lsr #29
 1234 0036 C200     		lsls	r2, r0, #3
 1235 0038 3346     		mov	r3, r6
 1236 003a 0733     		adds	r3, r3, #7
 1237 003c DB08     		lsrs	r3, r3, #3
 1238 003e DB00     		lsls	r3, r3, #3
 1239 0040 ADEB030D 		sub	sp, sp, r3
 1240 0044 6B46     		mov	r3, sp
 1241 0046 0033     		adds	r3, r3, #0
 1242 0048 FB60     		str	r3, [r7, #12]
 374:App/STM32F4-Discovery/spi.c **** 		buffer[0] = ((address & 0xff00) >> 8); // addres byte 1 
 1243              		.loc 1 374 0
 1244 004a FB88     		ldrh	r3, [r7, #6]
 1245 004c 1B0A     		lsrs	r3, r3, #8
 1246 004e 9BB2     		uxth	r3, r3
 1247 0050 DAB2     		uxtb	r2, r3
 1248 0052 FB68     		ldr	r3, [r7, #12]
 1249 0054 1A70     		strb	r2, [r3]
 375:App/STM32F4-Discovery/spi.c **** 		buffer[1] = ((address & 0x00ff)); //address byte 2 
 1250              		.loc 1 375 0
 1251 0056 FB88     		ldrh	r3, [r7, #6]	@ movhi
 1252 0058 DAB2     		uxtb	r2, r3
 1253 005a FB68     		ldr	r3, [r7, #12]
 1254 005c 5A70     		strb	r2, [r3, #1]
 376:App/STM32F4-Discovery/spi.c **** 		buffer[2] = ((0x00 | (data_len & 0x7f00) >> 8 ));
 1255              		.loc 1 376 0
 1256 005e BB88     		ldrh	r3, [r7, #4]
 1257 0060 03F4FE43 		and	r3, r3, #32512
 1258 0064 1B12     		asrs	r3, r3, #8
 1259 0066 DAB2     		uxtb	r2, r3
 1260 0068 FB68     		ldr	r3, [r7, #12]
 1261 006a 9A70     		strb	r2, [r3, #2]
 377:App/STM32F4-Discovery/spi.c **** 		buffer[3] = (data_len & 0x00ff);
 1262              		.loc 1 377 0
 1263 006c BB88     		ldrh	r3, [r7, #4]	@ movhi
 1264 006e DAB2     		uxtb	r2, r3
 1265 0070 FB68     		ldr	r3, [r7, #12]
 1266 0072 DA70     		strb	r2, [r3, #3]
 378:App/STM32F4-Discovery/spi.c **** 
 379:App/STM32F4-Discovery/spi.c **** 		int i;
 380:App/STM32F4-Discovery/spi.c **** 		for (i = 4 ; i < data_len+4; i++) buffer[i] = 0x0;
 1267              		.loc 1 380 0
 1268 0074 0423     		movs	r3, #4
 1269 0076 7B61     		str	r3, [r7, #20]
 1270 0078 07E0     		b	.L36
 1271              	.L37:
 1272              		.loc 1 380 0 is_stmt 0 discriminator 2
 1273 007a FA68     		ldr	r2, [r7, #12]
 1274 007c 7B69     		ldr	r3, [r7, #20]
 1275 007e 1344     		add	r3, r3, r2
 1276 0080 0022     		movs	r2, #0
 1277 0082 1A70     		strb	r2, [r3]
 1278 0084 7B69     		ldr	r3, [r7, #20]
 1279 0086 0133     		adds	r3, r3, #1
 1280 0088 7B61     		str	r3, [r7, #20]
 1281              	.L36:
 1282              		.loc 1 380 0 discriminator 1
 1283 008a BB88     		ldrh	r3, [r7, #4]
 1284 008c 1A1D     		adds	r2, r3, #4
 1285 008e 7B69     		ldr	r3, [r7, #20]
 1286 0090 9A42     		cmp	r2, r3
 1287 0092 F2DC     		bgt	.L37
 381:App/STM32F4-Discovery/spi.c **** 
 382:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_RX_DMA_STREAM, data_len+4);
 1288              		.loc 1 382 0 is_stmt 1
 1289 0094 BB88     		ldrh	r3, [r7, #4]	@ movhi
 1290 0096 0433     		adds	r3, r3, #4
 1291 0098 9BB2     		uxth	r3, r3
 1292 009a 1748     		ldr	r0, .L38
 1293 009c 1946     		mov	r1, r3
 1294 009e FFF7FEFF 		bl	DMA_SetCurrDataCounter
 383:App/STM32F4-Discovery/spi.c **** 		DMA_SetCurrDataCounter(SPIx_TX_DMA_STREAM, 4+data_len);
 1295              		.loc 1 383 0
 1296 00a2 BB88     		ldrh	r3, [r7, #4]	@ movhi
 1297 00a4 0433     		adds	r3, r3, #4
 1298 00a6 9BB2     		uxth	r3, r3
 1299 00a8 1448     		ldr	r0, .L38+4
 1300 00aa 1946     		mov	r1, r3
 1301 00ac FFF7FEFF 		bl	DMA_SetCurrDataCounter
 384:App/STM32F4-Discovery/spi.c **** 		SPIx_TX_DMA_STREAM->M0AR =(uint32_t) &buffer;	
 1302              		.loc 1 384 0
 1303 00b0 124B     		ldr	r3, .L38+4
 1304 00b2 FA68     		ldr	r2, [r7, #12]
 1305 00b4 DA60     		str	r2, [r3, #12]
 385:App/STM32F4-Discovery/spi.c **** 		SPIx_RX_DMA_STREAM->M0AR =(uint32_t)&bufferRX;	
 1306              		.loc 1 385 0
 1307 00b6 104B     		ldr	r3, .L38
 1308 00b8 114A     		ldr	r2, .L38+8
 1309 00ba DA60     		str	r2, [r3, #12]
 386:App/STM32F4-Discovery/spi.c **** 
 387:App/STM32F4-Discovery/spi.c **** 		CSON(); // chip select 
 1310              		.loc 1 387 0
 1311 00bc 114B     		ldr	r3, .L38+12
 1312 00be 114A     		ldr	r2, .L38+12
 1313 00c0 528B     		ldrh	r2, [r2, #26]	@ movhi
 1314 00c2 92B2     		uxth	r2, r2
 1315 00c4 42F01002 		orr	r2, r2, #16
 1316 00c8 92B2     		uxth	r2, r2
 1317 00ca 5A83     		strh	r2, [r3, #26]	@ movhi
 388:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_TX_DMA_STREAM, ENABLE);		
 1318              		.loc 1 388 0
 1319 00cc 0B48     		ldr	r0, .L38+4
 1320 00ce 0121     		movs	r1, #1
 1321 00d0 FFF7FEFF 		bl	DMA_Cmd
 389:App/STM32F4-Discovery/spi.c **** 		DMA_Cmd(SPIx_RX_DMA_STREAM, ENABLE);
 1322              		.loc 1 389 0
 1323 00d4 0848     		ldr	r0, .L38
 1324 00d6 0121     		movs	r1, #1
 1325 00d8 FFF7FEFF 		bl	DMA_Cmd
 390:App/STM32F4-Discovery/spi.c **** 		/* Block until the semaphore is given */
 391:App/STM32F4-Discovery/spi.c ****         	xSemaphoreTake(xSemaphoreDMASPI, portMAX_DELAY);	
 1326              		.loc 1 391 0
 1327 00dc 0A4B     		ldr	r3, .L38+16
 1328 00de 1B68     		ldr	r3, [r3]
 1329 00e0 1846     		mov	r0, r3
 1330 00e2 0021     		movs	r1, #0
 1331 00e4 4FF0FF32 		mov	r2, #-1
 1332 00e8 0023     		movs	r3, #0
 1333 00ea FFF7FEFF 		bl	xQueueGenericReceive
 1334 00ee C546     		mov	sp, r8
 392:App/STM32F4-Discovery/spi.c **** 		//CSOFF(); // chip deselect		
 393:App/STM32F4-Discovery/spi.c **** 
 394:App/STM32F4-Discovery/spi.c **** }	
 1335              		.loc 1 394 0
 1336 00f0 1837     		adds	r7, r7, #24
 1337 00f2 BD46     		mov	sp, r7
 1338              		@ sp needed
 1339 00f4 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1340              	.L39:
 1341              		.align	2
 1342              	.L38:
 1343 00f8 40640240 		.word	1073898560
 1344 00fc 58640240 		.word	1073898584
 1345 0100 00000000 		.word	bufferRX
 1346 0104 00000240 		.word	1073872896
 1347 0108 00000000 		.word	xSemaphoreDMASPI
 1348              		.cfi_endproc
 1349              	.LFE117:
 1351              		.text
 1352              	.Letext0:
 1353              		.file 2 "/Users/maticknap/ARM/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/machine/_default_
 1354              		.file 3 "/Users/maticknap/ARM/gcc-arm-none-eabi-4_8-2014q2/arm-none-eabi/include/stdint.h"
 1355              		.file 4 "App/STM32F4-Discovery/Libraries/CMSIS/ST/STM32F4xx/Include/stm32f4xx.h"
 1356              		.file 5 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_dma.h"
 1357              		.file 6 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_exti.h"
 1358              		.file 7 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_gpio.h"
 1359              		.file 8 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/stm32f4xx_spi.h"
 1360              		.file 9 "App/STM32F4-Discovery/Libraries/STM32F4xx_StdPeriph_Driver/inc/misc.h"
 1361              		.file 10 "Source/portable/GCC/ARM_CM4F/portmacro.h"
 1362              		.file 11 "Source/include/task.h"
 1363              		.file 12 "Source/include/queue.h"
 1364              		.file 13 "Source/include/semphr.h"
 1365              		.file 14 "App/STM32F4-Discovery/main.h"
 1366              		.file 15 "App/STM32F4-Discovery/Libraries/CMSIS/Include/core_cm4.h"
 1367              		.file 16 "App/STM32F4-Discovery/spi.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 spi.c
                            *COM*:0000000000000004 xSemaphoreDMASPI
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:21     .bss.xHigherPriorityTaskWoken:0000000000000000 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:24     .bss.xHigherPriorityTaskWoken:0000000000000000 xHigherPriorityTaskWoken
                            *COM*:0000000000000004 xSmphrUSART
                            *COM*:0000000000000004 motorHeartBeatHandle
                            *COM*:0000000000000004 motorHBHandle
                            *COM*:0000000000000004 QSpd_handle
                            *COM*:0000000000000004 QStatus_handle
                            *COM*:0000000000000004 socket_0
                            *COM*:00000000000007d0 bufferTX
                            *COM*:00000000000007d0 bufferRX
                            *COM*:0000000000000004 bufferRXidx
                            *COM*:0000000000000004 bufferTXidx
                            *COM*:0000000000000004 dat_lengthRX
                            *COM*:0000000000000004 dat_lengthTX
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:39     .text.init_SPIx:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:44     .text.init_SPIx:0000000000000000 init_SPIx
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:468    .text.init_SPIx:0000000000000304 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:480    .text.DMA2_Stream2_IRQHandler:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:485    .text.DMA2_Stream2_IRQHandler:0000000000000000 DMA2_Stream2_IRQHandler
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:568    .text.DMA2_Stream2_IRQHandler:000000000000007c $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:580    .text.DMA2_Stream3_IRQHandler:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:585    .text.DMA2_Stream3_IRQHandler:0000000000000000 DMA2_Stream3_IRQHandler
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:668    .text.DMA2_Stream3_IRQHandler:000000000000007c $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:680    .text.spi_dma_send:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:685    .text.spi_dma_send:0000000000000000 spi_dma_send
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:836    .text.spi_dma_send:0000000000000100 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:844    .text.spi_dma_send2B:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:849    .text.spi_dma_send2B:0000000000000000 spi_dma_send2B
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:946    .text.spi_dma_send2B:0000000000000094 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:954    .text.spi_dma_sendByte:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:959    .text.spi_dma_sendByte:0000000000000000 spi_dma_sendByte
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1049   .text.spi_dma_sendByte:0000000000000088 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1057   .text.spi_dma_read2B:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1062   .text.spi_dma_read2B:0000000000000000 spi_dma_read2B
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1179   .text.spi_dma_read2B:00000000000000b0 $d
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1188   .text.spi_dma_read:0000000000000000 $t
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1193   .text.spi_dma_read:0000000000000000 spi_dma_read
/var/folders/hq/s45830mn6w17j2ybbkgkrjk00000gn/T//cc4bTL7T.s:1343   .text.spi_dma_read:00000000000000f8 $d
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
RCC_AHB1PeriphClockCmd
GPIO_Init
GPIO_PinAFConfig
RCC_APB2PeriphClockCmd
SPI_Init
SPI_Cmd
DMA_DeInit
DMA_GetCmdStatus
DMA_StructInit
DMA_Init
DMA_ITConfig
SPI_I2S_ClearFlag
NVIC_Init
SPI_I2S_DMACmd
SYSCFG_EXTILineConfig
EXTI_Init
DMA_GetITStatus
DMA_ClearITPendingBit
SPI_I2S_GetFlagStatus
DMA_Cmd
vPortEnterCritical
xQueueGenericSendFromISR
vPortExitCritical
DMA_SetCurrDataCounter
xQueueGenericReceive
